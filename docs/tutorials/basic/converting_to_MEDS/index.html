<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/basic/converting_to_MEDS" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Converting to MEDS | MEDS: a Health AI Ecosystem</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://medical-event-data-standard.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://medical-event-data-standard.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://medical-event-data-standard.github.io/docs/tutorials/basic/converting_to_MEDS"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Converting to MEDS | MEDS: a Health AI Ecosystem"><meta data-rh="true" name="description" content="In this tutorial, we&#x27;ll extract a dataset in MEDS format for downstream use. See below for the jupyter"><meta data-rh="true" property="og:description" content="In this tutorial, we&#x27;ll extract a dataset in MEDS format for downstream use. See below for the jupyter"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://medical-event-data-standard.github.io/docs/tutorials/basic/converting_to_MEDS"><link data-rh="true" rel="alternate" href="https://medical-event-data-standard.github.io/docs/tutorials/basic/converting_to_MEDS" hreflang="en"><link data-rh="true" rel="alternate" href="https://medical-event-data-standard.github.io/docs/tutorials/basic/converting_to_MEDS" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorial - Build a Model with MEDS","item":"https://medical-event-data-standard.github.io/docs/category/tutorial---build-a-model-with-meds"},{"@type":"ListItem","position":2,"name":"Converting to MEDS","item":"https://medical-event-data-standard.github.io/docs/tutorials/basic/converting_to_MEDS"}]}</script><link rel="stylesheet" href="/assets/css/styles.af4d4dfa.css">
<script src="/assets/js/runtime~main.3d8cb0cf.js" defer="defer"></script>
<script src="/assets/js/main.15ab0ca3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="MEDS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-dark.svg" alt="MEDS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">MEDS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro_pages/intro">Get Started</a><a class="navbar__item navbar__link" href="/docs/MEDS-DEV/intro">MEDS-DEV</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Medical-Event-Data-Standard" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro_pages/intro">Welcome to MEDS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro_pages/what_is_MEDS">What is MEDS?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/tutorial---build-a-model-with-meds">Tutorial - Build a Model with MEDS</a><button aria-label="Collapse sidebar category &#x27;Tutorial - Build a Model with MEDS&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/basic/converting_to_MEDS">Converting to MEDS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/basic/preprocessing_MEDS_data">Pre-processing MEDS Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/basic/extracting_prediction_tasks">Extracting a Prediction Task Cohort from MEDS Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/basic/modeling_over_MEDS_data">Modeling over MEDS data</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro_pages/ecosystem">MEDS Ecosystem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro_pages/roadmap">Future Roadmap</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/tutorial---build-a-model-with-meds"><span>Tutorial - Build a Model with MEDS</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Converting to MEDS</span></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>Converting to MEDS</h1></header>
<p>In this tutorial, we&#x27;ll extract a dataset in MEDS format for downstream use. See below for the jupyter
notebook tutorial, rendered here, or check it out online on <a href="https://colab.research.google.com/github/Medical-Event-Data-Standard/medical-event-data-standard.github.io/blob/main/tutorial_notebooks/KDD_tutorial/MEDS_Extract.ipynb" target="_blank" rel="noopener noreferrer">Google
Colab</a>
or on our <a href="https://github.com/Medical-Event-Data-Standard/medical-event-data-standard.github.io/blob/main/tutorial_notebooks/KDD_tutorial/MEDS_Extract.ipynb" target="_blank" rel="noopener noreferrer">GitHub Repository</a></p>
<div class="jupyter-viewer"><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h1>Converting a Custom Dataset to MEDS</h1></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h2>Part 1: Loading the raw data</h2>
<p>In this tutorial, we&#x27;ll use the publicly available <a href="https://physionet.org/content/mimic-iv-demo/2.2/">MIMIC-IV Demo v2.2</a> dataset as our fictional &quot;raw data source&quot;. Naturally, MIMIC has been used extensively in the public space, so its structure is actually very well understood and widely used; however, for the sake of this tutorial, let&#x27;s act as though it isn&#x27;t and we&#x27;re seeing it for the first time.</p>
<p>The first thing we need to do is load up the raw data (or, really, generally, a small random chunk of the raw data, so we can iterate quickly, though here we&#x27;ll just use the entire demo dataset given its size) and take a look at it. To do that, we&#x27;ll go ahead and download the raw files from PhysioNet and store them in the newly created <code>raw_data</code> directory (<em>note this will take some time</em>):</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[1]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">12</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>%%bash
</span>mkdir -p raw_data
<!-- -->
<!-- -->wget \
<!-- -->  --quiet \
<!-- -->  --no-host-directories \
<!-- -->  --recursive \
<!-- -->  --no-parent \
<span>  --cut-dirs=</span><span class="hljs-number">3</span><span> \
</span>  --directory-prefix \
<!-- -->  raw_data \
<span>  https://physionet.org/files/mimic-iv-demo/</span><span class="hljs-number">2.2</span><span>/</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>Now that the files have downloaded, what do they actually contain?</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[2]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">4</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>%%bash
</span>apt-get -qq install tree
<!-- -->
<!-- -->tree raw_data</code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">raw_data
├── demo_subject_id.csv
├── hosp
│   ├── admissions.csv.gz
│   ├── d_hcpcs.csv.gz
│   ├── diagnoses_icd.csv.gz
│   ├── d_icd_diagnoses.csv.gz
│   ├── d_icd_procedures.csv.gz
│   ├── d_labitems.csv.gz
│   ├── drgcodes.csv.gz
│   ├── emar.csv.gz
│   ├── emar_detail.csv.gz
│   ├── hcpcsevents.csv.gz
│   ├── index.html
│   ├── labevents.csv.gz
│   ├── microbiologyevents.csv.gz
│   ├── omr.csv.gz
│   ├── patients.csv.gz
│   ├── pharmacy.csv.gz
│   ├── poe.csv.gz
│   ├── poe_detail.csv.gz
│   ├── prescriptions.csv.gz
│   ├── procedures_icd.csv.gz
│   ├── provider.csv.gz
│   ├── services.csv.gz
│   └── transfers.csv.gz
├── icu
│   ├── caregiver.csv.gz
│   ├── chartevents.csv.gz
│   ├── datetimeevents.csv.gz
│   ├── d_items.csv.gz
│   ├── icustays.csv.gz
│   ├── index.html
│   ├── ingredientevents.csv.gz
│   ├── inputevents.csv.gz
│   ├── outputevents.csv.gz
│   └── procedureevents.csv.gz
├── index.html
├── LICENSE.txt
├── README.txt
├── robots.txt
└── SHA256SUMS.txt

2 directories, 39 files
</pre></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>We can see there are a number of data files here, including:</p>
<ul>
<li><code>hosp/*.csv.gz</code></li>
<li><code>icu/*.csv.gz</code></li>
</ul>
<p>as well as a variety of other, likely non-data files. To understand any clinical dataset, you generally should rely on both provided documentation and a <em>local, subject-matter expert</em> who is familiar with both the <em>clinical and operational</em> context of the dataset; however, in practice, we rarely have this. For our purposes, let&#x27;s take a look at the provided <a href="https://mimic.mit.edu/docs/iv/">MIMIC-IV documentation</a> to try to understand these various files.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h2>Part 2: MEDS Extraction, conceptually</h2>
<p>For now, we&#x27;ll focus on only a few files, to keep things simple (note that each file below links to its specific data source documentation):</p>
<ol>
<li><a href="https://mimic.mit.edu/docs/iv/modules/hosp/patients"><code>hosp/patients.csv.gz</code></a></li>
<li><a href="https://mimic.mit.edu/docs/iv/modules/hosp/admissions"><code>hosp/admissions.csv.gz</code></a></li>
<li><a href="https://mimic.mit.edu/docs/iv/modules/hosp/procedures_icd"><code>hosp/procedures_icd.csv.gz</code></a></li>
<li><a href="https://mimic.mit.edu/docs/iv/modules/icu/icustays"><code>icu/icustays.csv.gz</code></a></li>
<li><a href="https://mimic.mit.edu/docs/iv/modules/icu/chartevents"><code>icu/chartevents.csv.gz</code></a></li>
</ol>
<p>To start understanding how we should think about extracting a MEDS view of this data, let&#x27;s inspect some of the data using <a href="https://pandas.pydata.org/">pandas</a>:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[3]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">15</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">16</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">17</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">19</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span style="color:#00f">import</span><span> pandas </span><span style="color:#00f">as</span><span> pd
</span><span></span><span style="color:#00f">from</span><span> pathlib </span><span style="color:#00f">import</span><span> Path
</span>
<span>DATA_ROOT = Path(</span><span style="color:#a31515">&quot;raw_data&quot;</span><span>)
</span>
<!-- -->dfs = {}
<!-- -->
<span></span><span style="color:#00f">for</span><span> fn </span><span style="color:#00f">in</span><span> [
</span><span>    </span><span style="color:#a31515">&quot;hosp/patients.csv.gz&quot;</span><span>,
</span><span>    </span><span style="color:#a31515">&quot;hosp/admissions.csv.gz&quot;</span><span>,
</span><span>    </span><span style="color:#a31515">&quot;hosp/procedures_icd.csv.gz&quot;</span><span>,
</span><span>    </span><span style="color:#a31515">&quot;icu/icustays.csv.gz&quot;</span><span>,
</span><span>    </span><span style="color:#a31515">&quot;icu/chartevents.csv.gz&quot;</span><span>,
</span>]:
<!-- -->  fp = DATA_ROOT / fn
<!-- -->  df = pd.read_csv(fp)
<span>  </span><span style="color:#00f">print</span><span>(</span><span style="color:#a31515">f&quot;</span><span class="hljs-subst" style="color:#a31515">{fn}</span><span style="color:#a31515">:&quot;</span><span>)
</span><span>  display(df.head(</span><span class="hljs-number">2</span><span>))
</span><span>  dfs[fn.split(</span><span style="color:#a31515">&quot;.&quot;</span><span>)[</span><span class="hljs-number">0</span><span>]] = df</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">hosp/patients.csv.gz:
</pre></div><div class="cell-row"><pre class="cell-header output"></pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-84036c5e-63cc-41cb-88dc-848d82100d64" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>gender</th>
      <th>anchor_age</th>
      <th>anchor_year</th>
      <th>anchor_year_group</th>
      <th>dod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10014729</td>
      <td>F</td>
      <td>21</td>
      <td>2125</td>
      <td>2011 - 2013</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10003400</td>
      <td>F</td>
      <td>72</td>
      <td>2134</td>
      <td>2011 - 2013</td>
      <td>2137-09-02</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-84036c5e-63cc-41cb-88dc-848d82100d64")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-84036c5e-63cc-41cb-88dc-848d82100d64 button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-84036c5e-63cc-41cb-88dc-848d82100d64"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const c=document.createElement("div");c.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(c)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-2de75599-65af-4334-b107-c38b4b9b2571">
      <button class="colab-df-quickchart" onclick='quickchart("df-2de75599-65af-4334-b107-c38b4b9b2571")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-2de75599-65af-4334-b107-c38b4b9b2571 button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">hosp/admissions.csv.gz:
</pre></div><div class="cell-row"><pre class="cell-header output"></pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-b9f62838-814b-4464-be91-0dfcdd8dd502" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>admittime</th>
      <th>dischtime</th>
      <th>deathtime</th>
      <th>admission_type</th>
      <th>admit_provider_id</th>
      <th>admission_location</th>
      <th>discharge_location</th>
      <th>insurance</th>
      <th>language</th>
      <th>marital_status</th>
      <th>race</th>
      <th>edregtime</th>
      <th>edouttime</th>
      <th>hospital_expire_flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10004235</td>
      <td>24181354</td>
      <td>2196-02-24 14:38:00</td>
      <td>2196-03-04 14:02:00</td>
      <td>NaN</td>
      <td>URGENT</td>
      <td>P03YMR</td>
      <td>TRANSFER FROM HOSPITAL</td>
      <td>SKILLED NURSING FACILITY</td>
      <td>Medicaid</td>
      <td>ENGLISH</td>
      <td>SINGLE</td>
      <td>BLACK/CAPE VERDEAN</td>
      <td>2196-02-24 12:15:00</td>
      <td>2196-02-24 17:07:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10009628</td>
      <td>25926192</td>
      <td>2153-09-17 17:08:00</td>
      <td>2153-09-25 13:20:00</td>
      <td>NaN</td>
      <td>URGENT</td>
      <td>P41R5N</td>
      <td>TRANSFER FROM HOSPITAL</td>
      <td>HOME HEALTH CARE</td>
      <td>Medicaid</td>
      <td>?</td>
      <td>MARRIED</td>
      <td>HISPANIC/LATINO - PUERTO RICAN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-b9f62838-814b-4464-be91-0dfcdd8dd502")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-b9f62838-814b-4464-be91-0dfcdd8dd502 button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-b9f62838-814b-4464-be91-0dfcdd8dd502"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const n=document.createElement("div");n.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(n)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-a2478356-125b-4629-8354-2f1c2ca45276">
      <button class="colab-df-quickchart" onclick='quickchart("df-a2478356-125b-4629-8354-2f1c2ca45276")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(c){const e=document.querySelector("#"+c+" button");e.disabled=!0,e.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[c],{})}catch(c){console.error("Error during call to suggestCharts:",c)}e.classList.remove("colab-df-spinner"),e.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-a2478356-125b-4629-8354-2f1c2ca45276 button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">hosp/procedures_icd.csv.gz:
</pre></div><div class="cell-row"><pre class="cell-header output"></pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-78d9b596-9051-4f61-a606-d6de3fb3ab2d" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>seq_num</th>
      <th>chartdate</th>
      <th>icd_code</th>
      <th>icd_version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10011398</td>
      <td>27505812</td>
      <td>3</td>
      <td>2146-12-15</td>
      <td>3961</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10011398</td>
      <td>27505812</td>
      <td>2</td>
      <td>2146-12-15</td>
      <td>3615</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-78d9b596-9051-4f61-a606-d6de3fb3ab2d")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-78d9b596-9051-4f61-a606-d6de3fb3ab2d button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-78d9b596-9051-4f61-a606-d6de3fb3ab2d"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-042bd40b-46ce-47af-bd68-0792ec433f8a">
      <button class="colab-df-quickchart" onclick='quickchart("df-042bd40b-46ce-47af-bd68-0792ec433f8a")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-042bd40b-46ce-47af-bd68-0792ec433f8a button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">icu/icustays.csv.gz:
</pre></div><div class="cell-row"><pre class="cell-header output"></pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-635babb9-c41c-487e-9772-a8233c8bf59a" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>stay_id</th>
      <th>first_careunit</th>
      <th>last_careunit</th>
      <th>intime</th>
      <th>outtime</th>
      <th>los</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10018328</td>
      <td>23786647</td>
      <td>31269608</td>
      <td>Neuro Stepdown</td>
      <td>Neuro Stepdown</td>
      <td>2154-04-24 23:03:44</td>
      <td>2154-05-02 15:55:21</td>
      <td>7.702512</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10020187</td>
      <td>24104168</td>
      <td>37509585</td>
      <td>Neuro Surgical Intensive Care Unit (Neuro SICU)</td>
      <td>Neuro Stepdown</td>
      <td>2169-01-15 04:56:00</td>
      <td>2169-01-20 15:47:50</td>
      <td>5.452662</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-635babb9-c41c-487e-9772-a8233c8bf59a")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-635babb9-c41c-487e-9772-a8233c8bf59a button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-635babb9-c41c-487e-9772-a8233c8bf59a"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-a4a545ed-4634-4f82-bb8b-57fbbf62f95f">
      <button class="colab-df-quickchart" onclick='quickchart("df-a4a545ed-4634-4f82-bb8b-57fbbf62f95f")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const o=document.querySelector("#"+e+" button");o.disabled=!0,o.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}o.classList.remove("colab-df-spinner"),o.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-a4a545ed-4634-4f82-bb8b-57fbbf62f95f button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">icu/chartevents.csv.gz:
</pre></div><div class="cell-row"><pre class="cell-header output"></pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-26138ee5-f3a3-450a-8af7-17400d5c97b2" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>stay_id</th>
      <th>caregiver_id</th>
      <th>charttime</th>
      <th>storetime</th>
      <th>itemid</th>
      <th>value</th>
      <th>valuenum</th>
      <th>valueuom</th>
      <th>warning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10005817</td>
      <td>20626031</td>
      <td>32604416</td>
      <td>6770.0</td>
      <td>2132-12-16 00:00:00</td>
      <td>2132-12-15 23:45:00</td>
      <td>225054</td>
      <td>On</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10005817</td>
      <td>20626031</td>
      <td>32604416</td>
      <td>6770.0</td>
      <td>2132-12-16 00:00:00</td>
      <td>2132-12-15 23:43:00</td>
      <td>223769</td>
      <td>100</td>
      <td>100.0</td>
      <td>%</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-26138ee5-f3a3-450a-8af7-17400d5c97b2")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-26138ee5-f3a3-450a-8af7-17400d5c97b2 button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-26138ee5-f3a3-450a-8af7-17400d5c97b2"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-0f0ee0d4-71c0-4427-a6c2-d5d1659474a5">
      <button class="colab-df-quickchart" onclick='quickchart("df-0f0ee0d4-71c0-4427-a6c2-d5d1659474a5")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-0f0ee0d4-71c0-4427-a6c2-d5d1659474a5 button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>We can see there is a <em>lot</em> of data contained in just these files! How can we hope to go about unifying it all into the simple MEDS format in a reasonable time?</p>
<p>To do so, we&#x27;ll follow the assumptions of the MEDS-Extract library, which organizes the mapping of EHR data elements into the MEDS format via the following questions. For each row of each input source, we ask</p>
<ol>
<li>What is happening in this row?</li>
<li>To whom is it happening?</li>
<li>When is it happening?</li>
</ol>
<p>Once we can answer each of these three questions, we&#x27;re ready to extract a full MEDS dataset over our inputs.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Part 2.1 Mapping the <code>hosp/patients</code> table</h3>
<p>To see these in action, let&#x27;s work through our files in order, starting with <code>hosp/patients.csv.gz</code>:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[4]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>dfs[</span><span style="color:#a31515">&#x27;hosp/patients&#x27;</span><span>].head(</span><span class="hljs-number">2</span><span>)</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output">[4]: </pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-cfb7990b-533e-485c-a00e-5a783150bea5" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>gender</th>
      <th>anchor_age</th>
      <th>anchor_year</th>
      <th>anchor_year_group</th>
      <th>dod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10014729</td>
      <td>F</td>
      <td>21</td>
      <td>2125</td>
      <td>2011 - 2013</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10003400</td>
      <td>F</td>
      <td>72</td>
      <td>2134</td>
      <td>2011 - 2013</td>
      <td>2137-09-02</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-cfb7990b-533e-485c-a00e-5a783150bea5")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-cfb7990b-533e-485c-a00e-5a783150bea5 button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-cfb7990b-533e-485c-a00e-5a783150bea5"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-32958120-1fef-4719-a3e2-d9d00732201e">
      <button class="colab-df-quickchart" onclick='quickchart("df-32958120-1fef-4719-a3e2-d9d00732201e")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const o=document.querySelector("#"+e+" button");o.disabled=!0,o.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}o.classList.remove("colab-df-spinner"),o.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-32958120-1fef-4719-a3e2-d9d00732201e button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>We can see that this dataframe clearly captures some static data about the patients in the population, any external date-of-death information present about the subject, and meta-data about how this subject&#x27;s data is transformed when included in MIMIC via the <a href="https://mimic.mit.edu/docs/iv/modules/hosp/patients/#anchor_age-anchor_year-anchor_year_group">anchor year group</a>. The latter aspect won&#x27;t feature ino the MEDS representation, so this means we only have the following pieces of information to represent about the patient:</p>
<ol>
<li>The information in the <code>gender</code> column, which for this dataset we will assign to a static measurement given if is recorded as sudh within the raw dataset.</li>
<li>The information in the <code>anchor_age</code> column indicating the patient&#x27;s date of birth (after some transformation).</li>
<li>The information in the <code>dod</code> column, which <a href="https://mimic.mit.edu/docs/iv/modules/hosp/patients/#dod">contains a de-identified date of death for the patient</a>, if applicable.</li>
</ol>
<p>Ultimately, this tells us that for each row of the <code>hosp/patients</code> table, we&#x27;ll want to construct 3 MEDS events:</p>
<ol>
<li>A measurement for subject <code>subject_id</code> with a <code>null</code> timestamp with a code indicating the value in the <code>gender</code> column.</li>
<li>A measurement for subject <code>subject_id</code> with a timestamp given by the <code>dod</code> column (if it is not null) and the <code>MEDS_DEATH</code> code (as this is a death event) and no values.</li>
<li>A measurement for subject <code>subject_id</code> with a timestamp given by the difference between the <code>anchor_year</code> and the <code>anchor_age</code>, converted to a date-time, with the <code>MEDS_BIRTH</code> code and no values.</li>
</ol>
<p>Let&#x27;s record the information for these events in a simple, declarative format that we&#x27;ll encode in <a href="https://yaml.org/">YAML</a>. For now, just think of this as an <em>approximate</em> format -- it isn&#x27;t technically precise just yet. But, as we build up our specification, we&#x27;ll see how we can turn it into a complete description of the extraction process. In particular, we&#x27;ll have an outer level of the YAML correspond to the file we&#x27;re talking about (in this case <code>hosp/patients</code>) and then we&#x27;ll have an inner block for each of the 3 events we&#x27;ve identified, describing what columns they&#x27;ll use for to construct their timestamps and codes (we don&#x27;t have values for any of these events, but we&#x27;ll add them in later).</p>
<p>Specification so far:</p>
<pre><code class="language-yaml">hosp/patients:
  gender:
    subject_id: subject_id
    code: gender
    time: null
  death:
    subject_id: subject_id
    code: MEDS_DEATH
    time: dod @ 11:59 p.m.
  birth:
    subject_id: subject_id
    code: MEDS_BIRTH
    time: anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.
</code></pre></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p><strong>Note:</strong> Note that the <code>patients</code> table has already revealed two common complications when converting clinical data (to any format, not just MEDS):</p>
<ol>
<li>The <code>dod</code> column only provides a <em>date</em> level resolution, not a time level resolution. This means that we don&#x27;t know whether or not the patient died at 12:01 a.m. on that date or at 11:59 p.m. on that date, despite these two times being separated by nearly 24 full hours! This can cause issues with measurement ordering, the validity of temporal prediction tasks (e.g., predicting imminent mortality), etc. Ultimately, <em>some choice</em> needs to be made in how we want to represent this in MEDS. By design, MEDS does not allow you to specify a date-only timestamp, as such a timestamp does not permit a total ordering of measurements across different events. Here, as we know that death is a final event and is often (if not universally) the last event recorded for the patient, it makes sense to place it at the <em>latest possible time</em> within that date (i.e., add an implicit 11:59:59 p.m. onto the end of that timestamp column).</li>
<li>As this dataset records an &quot;age&quot; (via <code>anchor_age</code>) rather than an explicit date of birth, we have a similar, but even greater lack of temporal resolution in the date of birth column of the data. Here, we need to choose when within that year we should assign the patient&#x27;s date of birth; again, there is no &quot;right&quot; answer, but we need to make a choice. For this event, we&#x27;ll choose January 1st of that year, to keep things simple.</li>
</ol></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Part 2.2: The <code>hosp/admissions</code> table:</h3>
<p>Next, let&#x27;s inspect the <code>admissions</code> table:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[5]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>dfs[</span><span style="color:#a31515">&#x27;hosp/admissions&#x27;</span><span>].head(</span><span class="hljs-number">2</span><span>)</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output">[5]: </pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-1723d056-00f9-4761-bf3b-e5c2bf53d49b" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>admittime</th>
      <th>dischtime</th>
      <th>deathtime</th>
      <th>admission_type</th>
      <th>admit_provider_id</th>
      <th>admission_location</th>
      <th>discharge_location</th>
      <th>insurance</th>
      <th>language</th>
      <th>marital_status</th>
      <th>race</th>
      <th>edregtime</th>
      <th>edouttime</th>
      <th>hospital_expire_flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10004235</td>
      <td>24181354</td>
      <td>2196-02-24 14:38:00</td>
      <td>2196-03-04 14:02:00</td>
      <td>NaN</td>
      <td>URGENT</td>
      <td>P03YMR</td>
      <td>TRANSFER FROM HOSPITAL</td>
      <td>SKILLED NURSING FACILITY</td>
      <td>Medicaid</td>
      <td>ENGLISH</td>
      <td>SINGLE</td>
      <td>BLACK/CAPE VERDEAN</td>
      <td>2196-02-24 12:15:00</td>
      <td>2196-02-24 17:07:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10009628</td>
      <td>25926192</td>
      <td>2153-09-17 17:08:00</td>
      <td>2153-09-25 13:20:00</td>
      <td>NaN</td>
      <td>URGENT</td>
      <td>P41R5N</td>
      <td>TRANSFER FROM HOSPITAL</td>
      <td>HOME HEALTH CARE</td>
      <td>Medicaid</td>
      <td>?</td>
      <td>MARRIED</td>
      <td>HISPANIC/LATINO - PUERTO RICAN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-1723d056-00f9-4761-bf3b-e5c2bf53d49b")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-1723d056-00f9-4761-bf3b-e5c2bf53d49b button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-1723d056-00f9-4761-bf3b-e5c2bf53d49b"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const n=document.createElement("div");n.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(n)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-ab8ff6a4-608c-4f95-b0f1-0c556162e9f9">
      <button class="colab-df-quickchart" onclick='quickchart("df-ab8ff6a4-608c-4f95-b0f1-0c556162e9f9")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-ab8ff6a4-608c-4f95-b0f1-0c556162e9f9 button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>Here, we have a lot of additional pieces of data -- records of admissions, discharges, possible competing records of deaths, admission types, locations for both admissions and discharges, patient information at time of admission (e.g., insurance, language, marital status, race), and emergency department (<code>ed</code>*) registration &amp; discharge information. One new piece of complexity here that is worth noting is that many of these events are &quot;interval&quot; style events -- namely, events that present with both a start and an end time (e.g., an admission and discharge, an ED registration and an ED out, etc.). The &quot;MEDS way&quot; to handle such events is to simply include both a separate, appropriately timed start event and an end event -- that way you are representing each interaction separately in its appropriate place in the patient timeline. This comes through naturally when we focus on asking our three questions from above. With this perspective, we can quickly identify a list of measurements these columns represent:</p>
<ol>
<li>There is (or may be, if the timestamp is not null) a &quot;hospital admission&quot; of type <code>admission_type</code> to location <code>admission_location</code> at the time given by <code>admittime</code> for the subject given in <code>subject_id</code> (<em>Note we are not tracking the <code>admit_provider_id</code> as MEDS does not currently formalize the notion of the treating provider</em>).</li>
<li>At the time of the hospital admission, some <a href="https://mimic.mit.edu/docs/iv/modules/hosp/admissions/#insurance-language-marital_status-ethnicity">patient demographics</a> are collected about <code>subject_id</code>, including their:</li>
</ol>
<pre><code>- `insurance`
- `language`
- `marital_status`
- `race`
</code></pre>
<ol start="3">
<li>There may be a &quot;hospital discharge&quot; to the location <code>discharge_location</code> at time <code>dischtime</code> for <code>subject_id</code>.</li>
<li>There may be a &quot;death&quot; event at time <code>deathtime</code> for <code>subject_id</code>.</li>
<li>There may be an &quot;ED Registration&quot; event at time <code>edregtime</code> for <code>subject_id</code>.</li>
<li>There may be an &quot;ED Out&quot; event at time <code>edouttime</code> for <code>subject_id</code>.</li>
</ol>
<p>Given these event descriptions, we can update our specification as follows:</p>
<pre><code class="language-yaml">hosp/patients:
  gender:
    subject_id: subject_id
    code: gender
    time: null
  death:
    subject_id: subject_id
    code: MEDS_DEATH
    time: dod @ 11:59 p.m.
  birth:
    subject_id: subject_id
    code: MEDS_BIRTH
    time: anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.

hosp/admissions:
  admission:
    subject_id: subject_id
    code: &quot;HOSPITAL_ADMISSION//${admission_type}//${admission_location}&quot;
    time: admittime
  language:
    subject_id: subject_id
    code: &quot;LANGUAGE//${language}&quot;
    time: admittime
  marital_status:
    subject_id: subject_id
    code: &quot;MARITAL_STATUS//${marital_status}&quot;
    time: admittime
  insurance:
    subject_id: subject_id
    code: &quot;INSURANCE//${insurance}&quot;
    time: admittime
  race:
    subject_id: subject_id
    code: &quot;RACE//${race}&quot;
    time: admittime
  discharge:
    subject_id: subject_id
    code: &quot;HOSPITAL_DISCHARGE//${discharge_location}&quot;
    time: dischtime
  death:
    subject_id: subject_id
    code: MEDS_DEATH
    time: deathtime
  ed_reg:
    subject_id: subject_id
    code: ED_REGISTRATION
    time: edregtime
  ed_out:
    subject_id: subject_id
    code: ED_OUT
    time: edouttime
</code></pre>
<p><em>Heads up that we&#x27;re being a bit imprecise with our syntax here, as this is just (for now) a mental aid -- namely, we&#x27;re using some plain strings to represent column names (e.g., <code>code: gender</code> and <code>subject_id: subject_id</code>) and sometimes we&#x27;re using strings explicitly indicated with double-quotes to indicate compound codes using python&#x27;s string interpolation syntax (e.g., `code: &quot;HOSPITAL_DISCHARGE//${discharge_location}&quot;). We&#x27;ll formalize this later, but for now, use context to disambiguate which we mean.</em></p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>Note that, much like before we&#x27;ve seen some other areas where challenges arise and assumptions need to be made in mapping this table:</p>
<ol>
<li><strong>Multifactorial measurements</strong>: Here, there are several measurements that come with different parts. We have admissions occurring with types and to locations alongside demographic data being measured like language, marital status, race, and insurance type. How should we map all of these to a set of distinct measurements with what codes? In general, this question comes down to a trade-off between <em>more simultaneous measurements</em> vs. <em>more complex codes</em> -- i.e., you can either produce more measurements for each distinct aspect of the code at the same time-point, or you can add more pieces of information into a single code string, thereby increasing the size of your vocabulary. This data extraction step shows both strategies in action, for good reason:</li>
</ol>
<ul>
<li>
<p>For admission type and location, we include them in the core hospital admission code. This makes sense because <em>every admission has to have a type and a location</em> -- so they are natural &quot;modifiers&quot; to the admission measurement conceptually, as opposed to being distinct measurements. We&#x27;d also almost never have a situation where a model would need to know that an admission happened, but not know of what type or to where.</p>
</li>
<li>
<p>On the other hand, for the patient demographic information, these have each been separated into distinct measurements all at the same point in time -- each aspect of the demographic data is thus recorded separately, so if we wish to later filter out rare or unknown recordings for one aspect of the demographic data in isolation of the others, this will be easy to do at a measurement level. Ultimately, however, it may also be reasonable (or even work better in some modeling tasks) to instead have produced a joint code string across all demographic information (e.g., <code>LANGUAGE//${language}//INSURANCE//${insurance}//...</code>). If you want to try that out yourself, let us know if it works better!</p>
</li>
</ul>
<p>The existence of these multifactorial codes also highlights a convention we&#x27;ll take in this guide, which is to compose &quot;structured code strings&quot; using the double-slash (<code>&quot;//&quot;</code>) as a separator, as this is unlikely to occur in a raw code string. This is not a formal requirement, so feel free to use a different approach in your data -- but what is important to note is that you likely do not want code strings to collide across different measurement sources. So, if you just used <code>code: race</code> and <code>code: language</code>, for example, and <code>UNK</code> was an option for both <code>race</code> and <code>language</code>, your model&#x27;s wouldn&#x27;t be able to differentiate between those two options unless you use a unique prefix (like we do here).</p>
<ol start="2">
<li><strong>Competing Measurement Sources</strong>: There&#x27;s <em>another</em> death time in this file, in addition to the <code>dod</code> recorded in the <code>patients</code> table! This is, unfortunately, a common enough problem in EHR data. Luckily, its solution is pretty straightforward -- simply decide which source has precedent (ideally this will be a universal property, not a data-dependent one) and favor that over the other. Here, as the <code>deathtime</code> in this dataset has full datetime resolution, it will be preferred over the <code>dod</code> in the other file. We&#x27;ll merely denote that with a comment in our specification for now.</li>
</ol></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>At this point, our specification is also getting pretty verbose. Let&#x27;s pull out the shared aspects across all event blocks into the upper level categories -- for now this just includes the <code>subject_id</code> specification -- so we can get rid of some wasted space:</p>
<pre><code class="language-yaml">subject_id: subject_id
hosp/patients:
  gender:
    code: gender
    time: null
  death: # Superceded by the `death` measurement in hosp/admissions
    code: MEDS_DEATH
    time: dod @ 11:59 p.m.
  birth:
    code: MEDS_BIRTH
    time: anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.

hosp/admissions:
  admission:
    code: &quot;HOSPITAL_ADMISSION//${admission_type}//${admission_location}&quot;
    time: admittime
  language:
    code: &quot;LANGUAGE//${language}&quot;
    time: admittime
  marital_status:
    code: &quot;MARITAL_STATUS//${marital_status}&quot;
    time: admittime
  insurance:
    code: &quot;INSURANCE//${insurance}&quot;
    time: admittime
  race:
    code: &quot;RACE//${race}&quot;
    time: admittime
  discharge:
    code: &quot;HOSPITAL_DISCHARGE//${discharge_location}&quot;
    time: dischtime
  death: # Takes precedent over the `death` measurement in hosp/patients
    code: MEDS_DEATH
    time: deathtime
  ed_reg:
    code: ED_REGISTRATION
    time: edregtime
  ed_out:
    code: ED_OUT
    time: edouttime
</code></pre>
<p>While there are other ways we could further condense this (e.g., using a list of objects rather than a dictionary of objects within each data source) that will hurt us more on clarity, so we&#x27;ll keep that for now.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Part 2.3: The <code>hosp/procedures_icd</code> table</h3>
<p>Let&#x27;s move onto our next table: <code>procedures_icd</code></p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[6]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>dfs[</span><span style="color:#a31515">&#x27;hosp/procedures_icd&#x27;</span><span>].head(</span><span class="hljs-number">2</span><span>)</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output">[6]: </pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-80ea0a43-6866-4116-a0ba-4b988f296b87" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>seq_num</th>
      <th>chartdate</th>
      <th>icd_code</th>
      <th>icd_version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10011398</td>
      <td>27505812</td>
      <td>3</td>
      <td>2146-12-15</td>
      <td>3961</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10011398</td>
      <td>27505812</td>
      <td>2</td>
      <td>2146-12-15</td>
      <td>3615</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-80ea0a43-6866-4116-a0ba-4b988f296b87")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-80ea0a43-6866-4116-a0ba-4b988f296b87 button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-80ea0a43-6866-4116-a0ba-4b988f296b87"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-2d80ec74-91ec-4e54-8f0a-f68cbb3dbd01">
      <button class="colab-df-quickchart" onclick='quickchart("df-2d80ec74-91ec-4e54-8f0a-f68cbb3dbd01")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-2d80ec74-91ec-4e54-8f0a-f68cbb3dbd01 button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>Here, we have a bit of an easier time -- there&#x27;s clearly only one measurement being recorded here -- the ICD code itself, recorded for <code>subject_id</code> at the time given by <code>chartdate</code>. However, much like for the <code>dod</code> column in the <code>hosp/patients</code> table, this is only a date, not a full datetime, so we need to decide at what timestamp within the date we should assign this. Here, the situation is not quite so simple; unlike death, which is clearly a &quot;final&quot; event, procedures can happen throughout the day, and we don&#x27;t know where it would be best to assign the recordings of their ICD codes. Ultimately, as we are more likely to want to predict things that are based on these procedures or heavily indicated by these procedures, it is better to put them later in the day rather than earlier to avoid temporal leakage -- though note that this can still cause leakage in tasks that are attempting to predict these procedure codes themselves! Regardless, we&#x27;ll assign them the time of 11:59:59 p.m. on the given day here. We&#x27;ll also want to ensure we capture both the <code>icd_code</code> and <code>icd_version</code> in these measurements, as both are necessary to fully define the assigned ICD code.</p>
<p>Before we show our new specification, note that there is one additional complexity here we should take into account, and that is <a href="https://mimic.mit.edu/docs/iv/modules/hosp/procedures_icd/#seq_num"><code>seq_num</code></a>. This is actually an important piece of information, as it indicates the relative prioritization of the given codes assigned to the patient (a lower <code>seq_num</code> indicating a higher priority code). This is a common paradigm for diagnostic codes in U.S. healthcare datasets, so we do want to include it; however, it doesn&#x27;t feel quite right to include it in the code as it is not a real part of the measurement about the patient. Instead, for this example, we&#x27;ll use the fact that MEDS datasets are permitted to include any other desired columns beyond the required columns, so we can just track it directly as an external column:</p>
<pre><code class="language-yaml">subject_id: subject_id
hosp/patients:
  gender:
    code: gender
    time: null
  death: # Superceded by the `death` measurement in hosp/admissions
    code: MEDS_DEATH
    time: dod @ 11:59 p.m.
  birth:
    code: MEDS_BIRTH
    time: anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.

hosp/admissions:
  admission:
    code: &quot;HOSPITAL_ADMISSION//${admission_type}//${admission_location}&quot;
    time: admittime
  language:
    code: &quot;LANGUAGE//${language}&quot;
    time: admittime
  marital_status:
    code: &quot;MARITAL_STATUS//${marital_status}&quot;
    time: admittime
  insurance:
    code: &quot;INSURANCE//${insurance}&quot;
    time: admittime
  race:
    code: &quot;RACE//${race}&quot;
    time: admittime
  discharge:
    code: &quot;HOSPITAL_DISCHARGE//${discharge_location}&quot;
    time: dischtime
  death: # Takes precedent over the `death` measurement in hosp/patients
    code: MEDS_DEATH
    time: deathtime
  ed_reg:
    code: ED_REGISTRATION
    time: edregtime
  ed_out:
    code: ED_OUT
    time: edouttime

hosp/procedures_icd:
  procedure_icd:
    code: &quot;PROCEDURE//ICD${icd_version}//${icd_code}&quot;
    time: chartdate @ 11:59 p.m.
    seq_num: seq_num
</code></pre></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Part 2.4: The <code>icu/icustays</code> table</h3>
<p>Now, let&#x27;s look at <code>icustays</code>:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[7]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>dfs[</span><span style="color:#a31515">&#x27;icu/icustays&#x27;</span><span>].head(</span><span class="hljs-number">2</span><span>)</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output">[7]: </pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-839a97b5-8fad-4365-8b8f-ccf17895e2d4" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>stay_id</th>
      <th>first_careunit</th>
      <th>last_careunit</th>
      <th>intime</th>
      <th>outtime</th>
      <th>los</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10018328</td>
      <td>23786647</td>
      <td>31269608</td>
      <td>Neuro Stepdown</td>
      <td>Neuro Stepdown</td>
      <td>2154-04-24 23:03:44</td>
      <td>2154-05-02 15:55:21</td>
      <td>7.702512</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10020187</td>
      <td>24104168</td>
      <td>37509585</td>
      <td>Neuro Surgical Intensive Care Unit (Neuro SICU)</td>
      <td>Neuro Stepdown</td>
      <td>2169-01-15 04:56:00</td>
      <td>2169-01-20 15:47:50</td>
      <td>5.452662</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-839a97b5-8fad-4365-8b8f-ccf17895e2d4")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-839a97b5-8fad-4365-8b8f-ccf17895e2d4 button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-839a97b5-8fad-4365-8b8f-ccf17895e2d4"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-a0dd0223-82ef-4557-91ed-05beaa5401dc">
      <button class="colab-df-quickchart" onclick='quickchart("df-a0dd0223-82ef-4557-91ed-05beaa5401dc")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-a0dd0223-82ef-4557-91ed-05beaa5401dc button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>This table is much like the <code>hosp/admissions</code> table -- we have some &quot;interval&quot; style events being recorded here (namely, ICU stays) which we&#x27;ll separate into endpoints, resulting in:</p>
<ol>
<li>An ICU admission event for <code>subject_id</code> at <code>intime</code> to the <code>first_careunit</code></li>
<li>An ICU discharge event for <code>subject_id</code> at <code>outtime</code> from the <code>last_careunit</code>.</li>
</ol>
<p>Note two things:</p>
<ul>
<li>The <code>los</code> here is actually a <em>derived</em> property -- it isn&#x27;t something we want to record in the MEDS data directly (especially not in the ICU admission event because that could risk future leakage).</li>
<li>We&#x27;re actually being a bit inconsistent here -- really, we should likely try to find another table in the MIMIC source which captures the sequence of careunits the patient is seen within so that we can record transfers <em>to a careunit</em> universally, rather than having an ICU admission <em>to a careunit</em> and an ICU discharge <em>from a careunit</em> -- but for now, this is outside the scope of our tutorial (but if you&#x27;re interested, the right table to use for this is the <a href="https://mimic.mit.edu/docs/iv/modules/hosp/transfers/"><code>hosp/transfers</code></a> table, which is actually the <a href="https://mimic.mit.edu/docs/iv/modules/hosp/transfers/#important-considerations">ground truth source for the <code>icu/icustays</code> table</a>.).</li>
</ul>
<p>When we add this to our spec, we obtain:</p>
<pre><code class="language-yaml">subject_id: subject_id
hosp/patients:
  gender:
    code: gender
    time: null
  death: # Superceded by the `death` measurement in hosp/admissions
    code: MEDS_DEATH
    time: dod @ 11:59 p.m.
  birth:
    code: MEDS_BIRTH
    time: anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.

hosp/admissions:
  admission:
    code: &quot;HOSPITAL_ADMISSION//${admission_type}//${admission_location}&quot;
    time: admittime
  language:
    code: &quot;LANGUAGE//${language}&quot;
    time: admittime
  marital_status:
    code: &quot;MARITAL_STATUS//${marital_status}&quot;
    time: admittime
  insurance:
    code: &quot;INSURANCE//${insurance}&quot;
    time: admittime
  race:
    code: &quot;RACE//${race}&quot;
    time: admittime
  discharge:
    code: &quot;HOSPITAL_DISCHARGE//${discharge_location}&quot;
    time: dischtime
  death: # Takes precedent over the `death` measurement in hosp/patients
    code: MEDS_DEATH
    time: deathtime
  ed_reg:
    code: ED_REGISTRATION
    time: edregtime
  ed_out:
    code: ED_OUT
    time: edouttime

hosp/procedures_icd:
  procedure_icd:
    code: &quot;PROCEDURE//ICD${icd_version}//${icd_code}&quot;
    time: chartdate @ 11:59 p.m.
    seq_num: seq_num

icu/icustays:
  admission:
    code: &quot;ICU_ADMISSION//${first_careunit}&quot;
    time: intime
  discharge:
    code: &quot;ICU_DISCHARGE//${last_careunit}&quot;
    time: outtime
</code></pre></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Part 2.5: <code>icu/chartevents</code>:</h3>
<p>Finally, let&#x27;s look at <code>chartevents</code>:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[8]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>dfs[</span><span style="color:#a31515">&#x27;icu/chartevents&#x27;</span><span>].head(</span><span class="hljs-number">2</span><span>)</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output">[8]: </pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-4bc40d4f-482d-4c07-b435-5b72c65743ac" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>stay_id</th>
      <th>caregiver_id</th>
      <th>charttime</th>
      <th>storetime</th>
      <th>itemid</th>
      <th>value</th>
      <th>valuenum</th>
      <th>valueuom</th>
      <th>warning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10005817</td>
      <td>20626031</td>
      <td>32604416</td>
      <td>6770.0</td>
      <td>2132-12-16 00:00:00</td>
      <td>2132-12-15 23:45:00</td>
      <td>225054</td>
      <td>On</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10005817</td>
      <td>20626031</td>
      <td>32604416</td>
      <td>6770.0</td>
      <td>2132-12-16 00:00:00</td>
      <td>2132-12-15 23:43:00</td>
      <td>223769</td>
      <td>100</td>
      <td>100.0</td>
      <td>%</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-4bc40d4f-482d-4c07-b435-5b72c65743ac")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-4bc40d4f-482d-4c07-b435-5b72c65743ac button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-4bc40d4f-482d-4c07-b435-5b72c65743ac"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const n=document.createElement("div");n.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(n)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-f1a4ddcf-0321-4190-9ac7-311a9a8f65bf">
      <button class="colab-df-quickchart" onclick='quickchart("df-f1a4ddcf-0321-4190-9ac7-311a9a8f65bf")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(c){const e=document.querySelector("#"+c+" button");e.disabled=!0,e.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[c],{})}catch(c){console.error("Error during call to suggestCharts:",c)}e.classList.remove("colab-df-spinner"),e.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-f1a4ddcf-0321-4190-9ac7-311a9a8f65bf button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>This table clearly has rows that capture a variety of recordings of some more nuanced measurements. Some have numerical results, units of measure, etc. We also have another complexity here in that we have some uncertainty in timestamp, with both <code>charttime</code> and <code>storetime</code> being included. Ultimately, though, there is still just one kind of measurement being recorded here: Namely, a &quot;chart event&quot; (often a lab test), identified via the &quot;Item ID&quot; <code>itemid</code> being recorded at either <code>charttime</code> or <code>storetime</code>, with a value given by the columns within <code>value</code>, <code>valuenum</code>, and <code>valueuom</code>. Let&#x27;s see how to add that to our specification (for brevity, we&#x27;ll just show the new bit first, before we put it all together):</p>
<pre><code class="language-yaml">icu/chartevents:
  chartevent:
    time: charttime
    code: &quot;CHARTEVENT//${itemid}//${valueuom}&quot;
    numeric_value: valuenum
</code></pre>
<p>Note here that we&#x27;ve made a few assumptions:</p>
<ol>
<li>We&#x27;ve defaulted to favor <code>charttime</code> here -- this is because, according to the <a href="https://mimic.mit.edu/docs/iv/modules/icu/chartevents/#charttime-storetime">data documentation</a>, <code>charttime</code> is the closest proxy to when the data was actually recorded. However, this could benefit from further investigation and empirical validation!</li>
<li>We are omitting the <code>warning</code> column -- this is because we don&#x27;t know when a warning would actually have been noted by the care-team, as it does not represent an automated process as part of the chart event measurement, but rather <a href="https://mimic.mit.edu/docs/iv/modules/icu/chartevents/#warning">is a manual observation by the care team after the data has been recorded</a></li>
</ol>
<p>In addition, this format has the following undesired property -- if <code>valueuom</code> is empty or <code>NaN</code>, the code string will have a trailing <code>//</code> (because we&#x27;ve included <code>valueuom</code> in the template, even though it will only be used for things with a numeric measurement). We can try to remedy this later, though it is not a high-priority issue as it only results in a superficial change.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>All told, this gives us a final &quot;specification&quot; for the data extraction (at a conceptual level) as follows:</p>
<pre><code class="language-yaml">subject_id: subject_id
hosp/patients:
  gender:
    code: gender
    time: null
  death: # Superceded by the `death` measurement in hosp/admissions
    code: MEDS_DEATH
    time: dod @ 11:59 p.m.
  birth:
    code: MEDS_BIRTH
    time: anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.

hosp/admissions:
  admission:
    code: &quot;HOSPITAL_ADMISSION//${admission_type}//${admission_location}&quot;
    time: admittime
  language:
    code: &quot;LANGUAGE//${language}&quot;
    time: admittime
  marital_status:
    code: &quot;MARITAL_STATUS//${marital_status}&quot;
    time: admittime
  insurance:
    code: &quot;INSURANCE//${insurance}&quot;
    time: admittime
  race:
    code: &quot;RACE//${race}&quot;
    time: admittime
  discharge:
    code: &quot;HOSPITAL_DISCHARGE//${discharge_location}&quot;
    time: dischtime
  death: # Takes precedent over the `death` measurement in hosp/patients
    code: MEDS_DEATH
    time: deathtime
  ed_reg:
    code: ED_REGISTRATION
    time: edregtime
  ed_out:
    code: ED_OUT
    time: edouttime

hosp/procedures_icd:
  procedure_icd:
    code: &quot;PROCEDURE//ICD${icd_version}//${icd_code}&quot;
    time: chartdate @ 11:59 p.m.
    seq_num: seq_num

icu/icustays:
  admission:
    code: &quot;ICU_ADMISSION//${first_careunit}&quot;
    time: intime
  discharge:
    code: &quot;ICU_DISCHARGE//${last_careunit}&quot;
    time: outtime

icu/chartevents:
  chartevent:
    time: charttime
    code: &quot;CHARTEVENT//${itemid}//${valueuom}&quot;
    numeric_value: valuenum
</code></pre>
<p>Then, our question becomes, how can we use this model to actually extract the data?</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h2>Part 3: Using MEDS-Extract to Automate Extraction</h2>
<p>So far, all we&#x27;ve built up is a <em>conceptual</em> map on how to think about extracting data to MEDS. Hopefully, in doing so, you&#x27;ve come to see how the <em>simplicity</em> of MEDS gives rise to likewise simple extraction pipelines -- rather than requiring hours or days to understand the various input files, you can often map the rows of input tables into a conceptual specification for MEDS extraction in minutes, even when presented with more complex cases that require some assumptions to be made.</p>
<p>However, as it turns out, not only is this conceptual specification useful theoretically, it also is very close to a precise technical specification that the MEDS-Extract package can use to extract your data in the MEDS format for you.</p>
<p>The MEDS-Extract library leverages <a href="https://github.com/mmcdermott/MEDS_transforms">MEDS-Transforms</a> to run a full ETL pipeline, with the secret sauce in the middle being the &quot;MEDS-Extract Specification Syntax YAML&quot; (MESSY) file -- which tells you how to map your messy input data into the MEDS format in alignment with this conceptual model.</p>
<p>This file is (as the name implies) in the YAML format and looks much like our specification above. It consists of blocks mapping input source table name to named measurements within the rows of that table, each measurement block having some sentinel properties which map to a prescribed extraction syntax that controls how the input data is parsed. It does, unfortunately, have some limitations that will make certain operations in our conceptual specification a bit harder. Let&#x27;s dig in!</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>The MESSY File Format</h3>
<h4>1. The Outer Structure</h4>
<p>First, much like our conceptual specification above, the MESSY file will have a block per input source, within which we&#x27;ll go through and identify all the measurements we want to extract from that source. In this case, that means we&#x27;ll have a block for each of the tables we&#x27;ve listed above:</p>
<pre><code class="language-yaml">hosp/patients:
  ...
hosp/admissions:
  ...
hosp/procedures_icd:
  ...
icu/icustays:
  ...
icu/chartevents:
  ...
</code></pre>
<p>Also, much like our specification above, we can specify <em>shared properties</em> at the top level -- so we can add back in our <code>subject_id</code> indicator as well, though in the MESSY format, we need to name it <code>subject_id_col</code> (for no particularly good reason):</p>
<pre><code class="language-yaml">subject_id_col: subject_id
hosp/patients:
  ...
hosp/admissions:
  ...
hosp/procedures_icd:
  ...
icu/icustays:
  ...
icu/chartevents:
  ...
</code></pre>
<h4>2. Measurement blocks</h4>
<p>Within each table source, we also need to specify all of the measurements we want to extract. Again, our format will look pretty similar, but a bit different. Our conceptual specification had measurements that looked like each of the following prototypical examples:</p>
<pre><code class="language-yaml">gender:
  code: gender
  time: null
death:
  code: MEDS_DEATH
  time: dod @ 11:59 p.m.
birth:
  code: MEDS_BIRTH
  time: anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.
admission:
  code: &quot;HOSPITAL_ADMISSION//${admission_type}//${admission_location}&quot;
  time: admittime
death:
  code: MEDS_DEATH
  time: deathtime
procedure_icd:
  code: &quot;PROCEDURE//ICD${icd_version}//${icd_code}&quot;
  time: chartdate @ 11:59 p.m.
  seq_num: seq_num
chartevent:
  time: charttime
  code: &quot;CHARTEVENT//${itemid}//${valueuom}&quot;
  numeric_value: valuenum
</code></pre>
<p>Let&#x27;s walk through each to see which features we&#x27;ll need to change:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h5><strong>Specifying Time Format Strings</strong></h5>
<p>A key missing piecce here is that we&#x27;ve indicated some strings are &quot;time&quot; columns, but we&#x27;re not saying how those should be parsed from the (string) input types accessible in our CSV files! While this is not an issue if our inputs were parquets or something else with typed timestamp columns, for CSVs we need to address it. Luckily, this is simple; we can just add a <code>time_format</code> key to each block with a time format string used to parse the column. Refer to the <a href="https://docs.rs/chrono/latest/chrono/format/strftime/index.html">chrono crate</a> documentation for how these format strings should be specified. In this case, we want the following format string for most use cases: <code>time_format: &quot;%Y-%m-%d %H:%M:%S&quot;</code>.</p>
<p>What if a column isn&#x27;t so nicely formatted, and there are multiple format strings in the data? You can also specify a list of format strings to the <code>time_format</code> key, and they will be used in specified order until one works on a given input for that column; e.g., <code>time_format: [&quot;%Y-%m-%d %H:%M:%S&quot;, &quot;%Y&quot;]</code>.</p>
<p>We&#x27;ll omit this added detail from our measurement configs for now in the interest of brevity, but see it added in at the end.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h5><strong>Disambiguating column references from string literals</strong></h5>
<p>We can see in the <code>gender</code> and <code>death</code> measurements that, in our conceptual specification, we sometimes used strings to refer to column names and sometimes as string literals. For the <em>code and time columns only</em>, the MESSY file disambiguates column references with <code>col(...)</code> and treats all others as string literals. String literals are only allowed for the <code>code</code> column; the <code>time</code> column can only accept <code>null</code> literals. So, we&#x27;ll need to make some changes to these blocks to account for this (note that as we&#x27;re making changes iteratively, they won&#x27;t be fully valid until we&#x27;re done). In some cases, it isn&#x27;t clear how to make the change we&#x27;re describing, so we&#x27;ll add <code>???</code> indicators to those cases.</p>
<pre><code class="language-yaml">gender: # We&#x27;re all done with this format -- this block is complete!
  code: col(gender)
  time: null
death:
  code: MEDS_DEATH
  time: ??? # dod @ 11:59 p.m.
birth:
  code: MEDS_BIRTH
  time: ??? # anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.
admission:
  code: ??? # &quot;HOSPITAL_ADMISSION//${admission_type}//${admission_location}&quot;
  time: col(admittime)
death: # We&#x27;re all done with this format -- this block is complete!
  code: MEDS_DEATH
  time: col(deathtime)
procedure_icd:
  code: ??? # &quot;PROCEDURE//ICD${icd_version}//${icd_code}&quot;
  time: ??? # chartdate @ 11:59 p.m.
  seq_num: seq_num # Note that this doesn&#x27;t need a col(...) specifier
chartevent:
  code: ??? # &quot;CHARTEVENT//${itemid}//${valueuom}&quot;
  time: col(charttime)
  numeric_value: valuenum # Note that this doesn&#x27;t need a col(...) specifier
</code></pre>
<p>Note that we can actually now see that in some cases, resolving this piece has &quot;completed&quot; a full block; <code>gender</code> and <code>death</code> are feature complete now, and can be omitted from the later sections for our tutorial pieces.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h5><strong>String interpolation in the code column</strong></h5>
<p>Another feature we see a lot of is string interpolation in the code column; e.g., <code>CHARTEVENT//${itemid}//${valueuom}</code>. How can we handle that?</p>
<p>Unfortunately, as of now, the MEDS-Extract does not allow generit string interpolation; but it does allow you to specify a list of parts which will be concatenated together with the <code>//</code> separator. This is done just by specifying a list of each of the literals or columns (with the <code>col(...)</code> syntax to denote the latter) in the YAML file directly. Let&#x27;s see it in action!</p>
<pre><code class="language-yaml">death:
  code: MEDS_DEATH
  time: ??? # dod @ 11:59 p.m.
birth:
  code: MEDS_BIRTH
  time: ??? # anchor_year - anchor_age @ Jan 1, 12:00:01 a.m.
admission: # We&#x27;re all done with this format -- this block is complete!
  code:
    - HOSPITAL_ADMISSION
    - col(admission_type)
    - col(admission_location)
  time: col(admittime)
procedure_icd:
  code:
    - PROCEDURE
    - ??? #ICD${icd_version}
    - col(icd_code)
  time: ??? # chartdate @ 11:59 p.m.
  seq_num: seq_num
chartevent: # We&#x27;re all done with this format -- this block is complete!
  code:
    - CHARTEVENT
    - col(itemid)
    - col(valueuom)
  time: col(charttime)
  numeric_value: valuenum
</code></pre>
<p>With this change, we&#x27;ve knocked out two blocks, but we see there is a tricky issue with a third -- the <code>procedure_icd</code> block doesn&#x27;t support expressing things in the way we want. This is unfortunate, but for now it is unavoidable, so we&#x27;ll have to change what we want the code string to be, and make the <code>ICD</code> part be separated from the version with another <code>//</code>:</p>
<pre><code class="language-yaml">procedure_icd:
  code:
    - PROCEDURE
    - ICD
    - coi(icd_version)
    - col(icd_code)
  time: ??? # chartdate @ 11:59 p.m.
  seq_num: seq_num
</code></pre></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h5><strong>Timestamp Resolution and basic arithmetic</strong></h5>
<p>Now, we have a tricky one: in all remaining sources of uncertainty, we have one of two (or more) problems going on -- either (a) we need to resolve a timestamp to a specific time of day (e.g., <code>chartdate @ 11:59 p.m.</code>) or (b) we need to perform some simple arithmetic (e.g., <code>anchor_year - anchor_age</code>).</p>
<p>MEDS-Extract does not currently support either of these operations. So, they need to happen in a &quot;pre-MEDS&quot; step, where we have some custom code go through and perform these operations for us on the raw dataframes, before we call MEDS-Extract. There are some other operations that might be required that MEDS-Extract can&#x27;t handle currently that you should know about (even though we don&#x27;t need them here), such as:</p>
<ol>
<li>Joining multiple tables together to ensure the <code>subject_id</code> is present in all cases.</li>
<li>Adjusting &quot;offset&quot; time columns into true datetime columns (this is actually just a case of arithmetic and datetime parsing as well, but it warrants an explicit mention).</li>
<li>Any data filtering that needs to happen before MEDS extraction occurs (though often data cleaning can happen after the MEDS conversion process as well).</li>
</ol>
<p>Let&#x27;s write a simple pre-MEDS step we can run here.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h5><strong>Pre-MEDS</strong></h5>
<p>Our Pre-MEDS step will have a few simple goals:</p>
<ol>
<li>Subtract the anchor age from the anchor year to get a &quot;year of birth&quot;</li>
<li>Resolve the timestamps in <code>hosp/procedures_icd</code>.</li>
<li>Remove the duplication between the <code>dod</code> column in <code>hosp/patients</code> and the <code>deathtime</code> in <code>hosp/admissions</code> to favor the latter where both are specified.</li>
</ol>
<p>We&#x27;ll write this using <code>pandas</code> for now, but you can use whatever method you want for your data.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[9]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">15</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">16</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">17</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">22</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">23</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">24</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">25</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">27</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">28</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">29</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">30</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span style="color:#00f">from</span><span> datetime </span><span style="color:#00f">import</span><span> timedelta
</span>
<span></span><span class="hljs-function" style="color:#00f">def</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a31515">get_year_of_birth</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">df: pd.DataFrame</span><span class="hljs-function">) -&gt; pd.DataFrame:</span><span>
</span><span>  df[</span><span style="color:#a31515">&quot;year_of_birth&quot;</span><span>] = (
</span><span>      df[</span><span style="color:#a31515">&quot;anchor_year&quot;</span><span>].astype(</span><span style="color:#00f">int</span><span>) - df[</span><span style="color:#a31515">&quot;anchor_age&quot;</span><span>].astype(</span><span style="color:#00f">int</span><span>)
</span><span>  ).astype(</span><span style="color:#00f">str</span><span>)
</span><span>  </span><span style="color:#00f">return</span><span> df
</span>
<span></span><span class="hljs-function" style="color:#00f">def</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a31515">put_procedure_at_EOD</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">df: pd.DataFrame</span><span class="hljs-function">) -&gt; pd.DataFrame:</span><span>
</span><span>  df[</span><span style="color:#a31515">&quot;chartdate&quot;</span><span>] = (
</span><span>      pd.to_datetime(df[</span><span style="color:#a31515">&quot;chartdate&quot;</span><span>], </span><span style="color:#00f">format</span><span>=</span><span style="color:#a31515">&quot;%Y-%m-%d&quot;</span><span>) +
</span><span>      timedelta(hours=</span><span class="hljs-number">23</span><span>, minutes=</span><span class="hljs-number">59</span><span>, seconds=</span><span class="hljs-number">59</span><span>)
</span>  )
<span>  </span><span style="color:#00f">return</span><span> df
</span>
<span></span><span class="hljs-function" style="color:#00f">def</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a31515">remove_dod_duplication_and_put_at_EOD</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">
</span><span class="hljs-function hljs-params">    patients_df: pd.DataFrame,
</span><span class="hljs-function hljs-params">    admissions_df: pd.DataFrame,
</span><span class="hljs-function hljs-params"></span><span class="hljs-function">) -&gt; pd.DataFrame:</span><span>
</span>  subjects_with_deathtime = (
<span>      admissions_df[~admissions_df[</span><span style="color:#a31515">&quot;deathtime&quot;</span><span>].isna()][</span><span style="color:#a31515">&quot;subject_id&quot;</span><span>]
</span>  )
<!-- -->
<span>  idx = patients_df[</span><span style="color:#a31515">&quot;subject_id&quot;</span><span>].isin(subjects_with_deathtime)
</span><span>  patients_df.loc[idx, </span><span style="color:#a31515">&quot;dod&quot;</span><span>] = </span><span style="color:#a31515">None</span><span>
</span><span>  patients_df[</span><span style="color:#a31515">&quot;dod&quot;</span><span>] = (
</span><span>      pd.to_datetime(patients_df[</span><span style="color:#a31515">&quot;dod&quot;</span><span>], </span><span style="color:#00f">format</span><span>=</span><span style="color:#a31515">&quot;%Y-%m-%d&quot;</span><span>) +
</span><span>      timedelta(hours=</span><span class="hljs-number">23</span><span>, minutes=</span><span class="hljs-number">59</span><span>, seconds=</span><span class="hljs-number">59</span><span>)
</span>  )
<span>  </span><span style="color:#00f">return</span><span> patients_df</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>We&#x27;ll store the output of our pre-MEDS stage in an &quot;intermediate directory&quot; called <code>intermediate_dir</code> -- that way we can always re-use our raw data.</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[10]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">12</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>INTERMEDIATE_DIR = Path(</span><span style="color:#a31515">&quot;intermediate_dir&quot;</span><span>)
</span>
<span></span><span style="color:#00f">for</span><span> name, df </span><span style="color:#00f">in</span><span> dfs.items():
</span><span>  </span><span style="color:#00f">if</span><span> name == </span><span style="color:#a31515">&quot;hosp/patients&quot;</span><span>:
</span>    df = get_year_of_birth(df)
<span>    df = remove_dod_duplication_and_put_at_EOD(df, dfs[</span><span style="color:#a31515">&quot;hosp/admissions&quot;</span><span>])
</span><span>  </span><span style="color:#00f">elif</span><span> name == </span><span style="color:#a31515">&quot;hosp/procedures_icd&quot;</span><span>:
</span>    df = put_procedure_at_EOD(df)
<!-- -->
<span>  out_fp = INTERMEDIATE_DIR / </span><span style="color:#a31515">f&quot;</span><span class="hljs-subst" style="color:#a31515">{name}</span><span style="color:#a31515">.parquet&quot;</span><span>
</span><span>  out_fp.parent.mkdir(parents=</span><span style="color:#a31515">True</span><span>, exist_ok=</span><span style="color:#a31515">True</span><span>)
</span>  df.to_parquet(out_fp)</code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[11]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>%%bash
</span>tree intermediate_dir</code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">intermediate_dir
├── hosp
│   ├── admissions.parquet
│   ├── patients.parquet
│   └── procedures_icd.parquet
└── icu
    ├── chartevents.parquet
    └── icustays.parquet

2 directories, 5 files
</pre></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[12]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>pd.read_parquet(INTERMEDIATE_DIR / </span><span style="color:#a31515">&quot;hosp/patients.parquet&quot;</span><span>).head(</span><span class="hljs-number">5</span><span>)</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output">[12]: </pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-24088522-df14-45a8-9bd3-2f88dbda71ef" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>gender</th>
      <th>anchor_age</th>
      <th>anchor_year</th>
      <th>anchor_year_group</th>
      <th>dod</th>
      <th>year_of_birth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10014729</td>
      <td>F</td>
      <td>21</td>
      <td>2125</td>
      <td>2011 - 2013</td>
      <td>NaT</td>
      <td>2104</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10003400</td>
      <td>F</td>
      <td>72</td>
      <td>2134</td>
      <td>2011 - 2013</td>
      <td>NaT</td>
      <td>2062</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10002428</td>
      <td>F</td>
      <td>80</td>
      <td>2155</td>
      <td>2011 - 2013</td>
      <td>NaT</td>
      <td>2075</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10032725</td>
      <td>F</td>
      <td>38</td>
      <td>2143</td>
      <td>2011 - 2013</td>
      <td>2143-03-30 23:59:59</td>
      <td>2105</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10027445</td>
      <td>F</td>
      <td>48</td>
      <td>2142</td>
      <td>2011 - 2013</td>
      <td>2146-02-09 23:59:59</td>
      <td>2094</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-24088522-df14-45a8-9bd3-2f88dbda71ef")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-24088522-df14-45a8-9bd3-2f88dbda71ef button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-24088522-df14-45a8-9bd3-2f88dbda71ef"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-927fa91d-110c-483c-af83-7e1c2ee387e7">
      <button class="colab-df-quickchart" onclick='quickchart("df-927fa91d-110c-483c-af83-7e1c2ee387e7")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-927fa91d-110c-483c-af83-7e1c2ee387e7 button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[13]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>pd.read_parquet(INTERMEDIATE_DIR / </span><span style="color:#a31515">&quot;hosp/procedures_icd.parquet&quot;</span><span>).head(</span><span class="hljs-number">5</span><span>)</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output">[13]: </pre><div class="cell-content output-display" style="justify-content:flex-start">
  <div id="df-47271601-d0b9-489d-aaf7-77913c634327" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subject_id</th>
      <th>hadm_id</th>
      <th>seq_num</th>
      <th>chartdate</th>
      <th>icd_code</th>
      <th>icd_version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10011398</td>
      <td>27505812</td>
      <td>3</td>
      <td>2146-12-15 23:59:59</td>
      <td>3961</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10011398</td>
      <td>27505812</td>
      <td>2</td>
      <td>2146-12-15 23:59:59</td>
      <td>3615</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10011398</td>
      <td>27505812</td>
      <td>1</td>
      <td>2146-12-15 23:59:59</td>
      <td>3614</td>
      <td>9</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10014729</td>
      <td>23300884</td>
      <td>4</td>
      <td>2125-03-23 23:59:59</td>
      <td>3897</td>
      <td>9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10014729</td>
      <td>23300884</td>
      <td>1</td>
      <td>2125-03-20 23:59:59</td>
      <td>3403</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick='convertToInteractive("df-47271601-d0b9-489d-aaf7-77913c634327")' title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>const buttonEl=document.querySelector("#df-47271601-d0b9-489d-aaf7-77913c634327 button.colab-df-convert");async function convertToInteractive(e){const t=document.querySelector("#df-47271601-d0b9-489d-aaf7-77913c634327"),o=await google.colab.kernel.invokeFunction("convertToInteractive",[e],{});if(!o)return;t.innerHTML="",o.output_type="display_data",await google.colab.output.renderOutput(o,t);const a=document.createElement("div");a.innerHTML='Like what you see? Visit the <a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a> to learn more about interactive tables.',t.appendChild(a)}buttonEl.style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
  </div>


    <div id="df-74e9c2d3-3310-4a5c-bd00-5b36083da3bd">
      <button class="colab-df-quickchart" onclick='quickchart("df-74e9c2d3-3310-4a5c-bd00-5b36083da3bd")' title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>async function quickchart(e){const c=document.querySelector("#"+e+" button");c.disabled=!0,c.classList.add("colab-df-spinner");try{await google.colab.kernel.invokeFunction("suggestCharts",[e],{})}catch(e){console.error("Error during call to suggestCharts:",e)}c.classList.remove("colab-df-spinner"),c.classList.add("colab-df-quickchart-complete")}document.querySelector("#df-74e9c2d3-3310-4a5c-bd00-5b36083da3bd button").style.display=google.colab.kernel.accessAllowed?"block":"none"</script>
    </div>

    </div>
  </div>
</div></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h5><strong>The final MESSY File</strong></h5>
<p>Now that we&#x27;ve resolved our remaining issues, let&#x27;s put together our final, complete MESSY file!</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[14]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">15</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">16</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">17</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">22</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">23</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">24</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">25</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">27</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">28</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">29</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">30</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">31</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">32</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">33</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">34</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">35</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">36</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">37</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">38</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">39</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">40</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">41</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">42</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">43</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">44</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">45</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">46</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">47</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">48</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">49</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">50</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">51</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">52</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">53</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">54</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">55</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">56</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">57</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">58</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">59</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">60</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">61</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">62</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">63</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">64</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">65</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">66</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">67</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">68</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">69</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">70</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">71</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">72</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">73</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">74</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">75</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">76</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">77</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>YAML_contents = </span><span style="color:#a31515">&quot;&quot;&quot;
</span><span style="color:#a31515">subject_id_col: subject_id
</span><span style="color:#a31515">hosp/patients:
</span><span style="color:#a31515">  gender:
</span><span style="color:#a31515">    code: col(gender)
</span><span style="color:#a31515">    time: null
</span><span style="color:#a31515">  death:
</span><span style="color:#a31515">    code: MEDS_DEATH
</span><span style="color:#a31515">    time: col(dod)
</span><span style="color:#a31515">  birth:
</span><span style="color:#a31515">    code: MEDS_BIRTH
</span><span style="color:#a31515">    time: col(year_of_birth)
</span><span style="color:#a31515">    time_format: &quot;%Y&quot;
</span><span style="color:#a31515">
</span><span style="color:#a31515">hosp/admissions:
</span><span style="color:#a31515">  ed_registration:
</span><span style="color:#a31515">    code: ED_REGISTRATION
</span><span style="color:#a31515">    time: col(edregtime)
</span><span style="color:#a31515">    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
</span><span style="color:#a31515">  ed_out:
</span><span style="color:#a31515">    code: ED_OUT
</span><span style="color:#a31515">    time: col(edouttime)
</span><span style="color:#a31515">    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
</span><span style="color:#a31515">  admission:
</span><span style="color:#a31515">    code:
</span><span style="color:#a31515">      - HOSPITAL_ADMISSION
</span><span style="color:#a31515">      - col(admission_type)
</span><span style="color:#a31515">      - col(admission_location)
</span><span style="color:#a31515">    time: col(admittime)
</span><span style="color:#a31515">    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
</span><span style="color:#a31515">    hadm_id: hadm_id
</span><span style="color:#a31515">  discharge:
</span><span style="color:#a31515">    code:
</span><span style="color:#a31515">      - HOSPITAL_DISCHARGE
</span><span style="color:#a31515">      - col(discharge_location)
</span><span style="color:#a31515">    time: col(dischtime)
</span><span style="color:#a31515">    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
</span><span style="color:#a31515">    hadm_id: hadm_id
</span><span style="color:#a31515">
</span><span style="color:#a31515">hosp/procedures_icd:
</span><span style="color:#a31515">  procedure_icd:
</span><span style="color:#a31515">    code:
</span><span style="color:#a31515">      - PROCEDURE
</span><span style="color:#a31515">      - ICD
</span><span style="color:#a31515">      - coi(icd_version)
</span><span style="color:#a31515">      - col(icd_code)
</span><span style="color:#a31515">    time: col(chartdate)
</span><span style="color:#a31515">    seq_num: seq_num
</span><span style="color:#a31515">
</span><span style="color:#a31515">icu/icustays:
</span><span style="color:#a31515">  admission:
</span><span style="color:#a31515">    code:
</span><span style="color:#a31515">      - ICU_ADMISSION
</span><span style="color:#a31515">      - col(first_careunit)
</span><span style="color:#a31515">    time: col(intime)
</span><span style="color:#a31515">    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
</span><span style="color:#a31515">  discharge:
</span><span style="color:#a31515">    code:
</span><span style="color:#a31515">      - ICU_DISCHARGE
</span><span style="color:#a31515">      - col(last_careunit)
</span><span style="color:#a31515">    time: col(outtime)
</span><span style="color:#a31515">    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
</span><span style="color:#a31515">
</span><span style="color:#a31515">icu/chartevents:
</span><span style="color:#a31515">  chartevent:
</span><span style="color:#a31515">    code:
</span><span style="color:#a31515">      - CHARTEVENT
</span><span style="color:#a31515">      - col(itemid)
</span><span style="color:#a31515">      - col(valueuom)
</span><span style="color:#a31515">    time: col(charttime)
</span><span style="color:#a31515">    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
</span><span style="color:#a31515">    numeric_value: valuenum
</span><span style="color:#a31515">&quot;&quot;&quot;</span><span>
</span>
<span>YAML_fp = Path(</span><span style="color:#a31515">&quot;MESSY.yaml&quot;</span><span>)
</span>YAML_fp.write_text(YAML_contents)
<span></span><span style="color:#00f">print</span><span>(YAML_fp.read_text())</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">

subject_id_col: subject_id
hosp/patients:
  gender:
    code: col(gender)
    time: null
  death:
    code: MEDS_DEATH
    time: col(dod)
  birth:
    code: MEDS_BIRTH
    time: col(year_of_birth)
    time_format: &quot;%Y&quot;

hosp/admissions:
  ed_registration:
    code: ED_REGISTRATION
    time: col(edregtime)
    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
  ed_out:
    code: ED_OUT
    time: col(edouttime)
    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
  admission:
    code:
      - HOSPITAL_ADMISSION
      - col(admission_type)
      - col(admission_location)
    time: col(admittime)
    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
    hadm_id: hadm_id
  discharge:
    code:
      - HOSPITAL_DISCHARGE
      - col(discharge_location)
    time: col(dischtime)
    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
    hadm_id: hadm_id

hosp/procedures_icd:
  procedure_icd:
    code:
      - PROCEDURE
      - ICD
      - coi(icd_version)
      - col(icd_code)
    time: col(chartdate)
    seq_num: seq_num

icu/icustays:
  admission:
    code:
      - ICU_ADMISSION
      - col(first_careunit)
    time: col(intime)
    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
  discharge:
    code:
      - ICU_DISCHARGE
      - col(last_careunit)
    time: col(outtime)
    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;

icu/chartevents:
  chartevent:
    code:
      - CHARTEVENT
      - col(itemid)
      - col(valueuom)
    time: col(charttime)
    time_format: &quot;%Y-%m-%d %H:%M:%S&quot;
    numeric_value: valuenum

</pre></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Using the MESSY File -- how do you run MEDS-Extract?</h3>
<p>With the MESSY file specified, running MEDS-Extract is easy. There are two steps. First, install the package:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>!pip --quiet install MEDS-extract</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>Next, use the <a href="https://github.com/mmcdermott/MEDS_transforms?tab=readme-ov-file#example-plugin-package">typical MEDS-Transforms syntax</a> for running a dependent pipeline, and pass in the override variables you want. In our case, the command will look like the below:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[17]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">9</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>%%bash
</span>MEDS_transform-pipeline \
<!-- -->    pkg://MEDS_extract.configs._extract.yaml \
<!-- -->    --overrides \
<!-- -->    input_dir=intermediate_dir \
<!-- -->    output_dir=output_dir \
<!-- -->    event_conversion_config_fp=MESSY.yaml \
<!-- -->    dataset.name=KDD_Tutorial \
<span>    dataset.version=</span><span class="hljs-number">1.0</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>If we&#x27;ve done things right, then we should see the above cell complete with no errors -- if we haven&#x27;t, we&#x27;ll need to debug. Thankfully, MEDS-Extract writes out some nice logs to help with this, which we can find in the output directory <code>output_dir</code>, under <code>output_dir/.logs/pipeline.log</code>:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[18]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> </span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>!cat output_dir/.logs/pipeline.log</span></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">INFO:root:Running MEDS-Transforms Pipeline Runner with the following arguments:
INFO:root:  pipeline_config_fp: pkg://MEDS_extract.configs._extract.yaml
INFO:root:  stage_runner_fp: None
INFO:root:  do_profile: False
INFO:root:  overrides: [&#x27;input_dir=intermediate_dir&#x27;, &#x27;output_dir=output_dir&#x27;, &#x27;event_conversion_config_fp=MESSY.yaml&#x27;, &#x27;dataset.name=KDD_Tutorial&#x27;, &#x27;dataset.version=1.0&#x27;]
INFO:MEDS_transforms.runner:No parallelization configuration provided.
INFO:MEDS_transforms.runner:Running stage: shard_events
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml shard_events stage=shard_events input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:49:41,164][MEDS_extract.shard_events.shard_events][INFO] - Running with config:
dataset:
  root_dir: ???
  name: KDD_Tutorial
  version: &#x27;1.0&#x27;
  code_modifiers: []
input_dir: intermediate_dir
output_dir: output_dir
_default_description: &#x27;This is a MEDS pipeline ETL. Please set a more detailed description
  at the top of your specific pipeline

  configuration file.&#x27;
log_dir: ${stage_cfg.output_dir}/.logs
do_overwrite: false
seed: 1
worker: 0
polling_time: 300
stages:
- shard_events
- split_and_shard_subjects
- convert_to_subject_sharded
- convert_to_MEDS_events
- merge_to_MEDS_cohort
- extract_code_metadata
- finalize_MEDS_metadata
- finalize_MEDS_data
stage: shard_events
etl_metadata:
  pipeline_name: MEDS-Transforms Pipeline
  dataset_name: ${dataset.name}
  dataset_version: ${dataset.version}
  package_name: ${get_package_name:}
  package_version: ${get_package_version:}
code_modifiers: null
etl_metadata.pipeline_name: extract
description: &quot;This pipeline extracts raw MEDS events in longitudinal, sparse form\
  \ from an input dataset meeting select\ncriteria and converts them to the flattened,\
  \ MEDS format. It can be run in its entirety, with controllable\nlevels of parallelism,\
  \ or in stages. Arguments:\n  - `event_conversion_config_fp`: The path to the event\
  \ conversion configuration file. This file defines\n    the events to extract from\
  \ the various rows of the various input files encountered in the global input\n\
  \    directory.\n  - `input_dir`: The path to the directory containing the raw input\
  \ files.\n  - `output_dir`: The path to the directory where the output cohort will\
  \ be written. It will be written in\n    various subfolders of this dir depending\
  \ on the stage, as intermediate stages cache their output during\n    computation\
  \ for efficiency of re-running and distributing.&quot;
event_conversion_config_fp: MESSY.yaml
shards_map_fp: ${output_dir}/metadata/.shards.json
cloud_io_storage_options: {}
stage_cfg:
  row_chunksize: 200000000
  infer_schema_length: 10000
  data_input_dir: ${input_dir}/data
  metadata_input_dir: ${input_dir}/metadata
  reducer_output_dir: null
  train_only: false
  output_dir: ${output_dir}/shard_events

Stage: shard_events

Stage config:
row_chunksize: 200000000
infer_schema_length: 10000
data_input_dir: ${input_dir}/data
metadata_input_dir: ${input_dir}/metadata
reducer_output_dir: null
train_only: false
output_dir: ${output_dir}/shard_events

[2025-07-17 17:49:41,167][MEDS_extract.shard_events.shard_events][INFO] - Reading event conversion config from MESSY.yaml to identify needed columns.
[2025-07-17 17:49:41,195][MEDS_extract.shard_events.shard_events][INFO] - Starting event sub-sharding. Sub-sharding 5 files:
  * /content/intermediate_dir/hosp/admissions.parquet
  * /content/intermediate_dir/hosp/procedures_icd.parquet
  * /content/intermediate_dir/icu/chartevents.parquet
  * /content/intermediate_dir/icu/icustays.parquet
  * /content/intermediate_dir/hosp/patients.parquet
[2025-07-17 17:49:41,196][MEDS_extract.shard_events.shard_events][INFO] - Will read raw data from /content/intermediate_dir/$IN_FILE.parquet and write sub-sharded data to output_dir/shard_events/$IN_FILE/$ROW_START-$ROW_END.parquet
[2025-07-17 17:49:41,198][MEDS_extract.shard_events.shard_events][INFO] - Processing intermediate_dir/hosp/admissions.parquet to output_dir/shard_events/hosp/admissions.
[2025-07-17 17:49:41,206][MEDS_extract.shard_events.shard_events][INFO] - Performing preliminary read of /content/intermediate_dir/hosp/admissions.parquet to determine row count.
[2025-07-17 17:49:41,207][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:41,234][MEDS_extract.shard_events.shard_events][INFO] - Read 275 rows from /content/intermediate_dir/hosp/admissions.parquet.
[2025-07-17 17:49:41,234][MEDS_extract.shard_events.shard_events][INFO] - Splitting intermediate_dir/hosp/admissions.parquet into 1 row-chunks of size 200000000.
[2025-07-17 17:49:41,235][MEDS_extract.shard_events.shard_events][INFO] - Writing file 1/1: intermediate_dir/hosp/admissions.parquet row-chunk [0-275) to output_dir/shard_events/hosp/admissions/[0-275).parquet.
[2025-07-17 17:49:41,236][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from intermediate_dir/hosp/admissions.parquet
[2025-07-17 17:49:41,236][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:41,236][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:41,237][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/shard_events/hosp/admissions/[0-275).parquet
[2025-07-17 17:49:41,261][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.024981
[2025-07-17 17:49:41,262][MEDS_extract.shard_events.shard_events][INFO] - Processing intermediate_dir/hosp/procedures_icd.parquet to output_dir/shard_events/hosp/procedures_icd.
[2025-07-17 17:49:41,262][MEDS_extract.shard_events.shard_events][INFO] - Performing preliminary read of /content/intermediate_dir/hosp/procedures_icd.parquet to determine row count.
[2025-07-17 17:49:41,263][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:41,273][MEDS_extract.shard_events.shard_events][INFO] - Read 722 rows from /content/intermediate_dir/hosp/procedures_icd.parquet.
[2025-07-17 17:49:41,274][MEDS_extract.shard_events.shard_events][INFO] - Splitting intermediate_dir/hosp/procedures_icd.parquet into 1 row-chunks of size 200000000.
[2025-07-17 17:49:41,274][MEDS_extract.shard_events.shard_events][INFO] - Writing file 1/1: intermediate_dir/hosp/procedures_icd.parquet row-chunk [0-722) to output_dir/shard_events/hosp/procedures_icd/[0-722).parquet.
[2025-07-17 17:49:41,275][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from intermediate_dir/hosp/procedures_icd.parquet
[2025-07-17 17:49:41,275][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:41,276][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:41,276][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/shard_events/hosp/procedures_icd/[0-722).parquet
[2025-07-17 17:49:41,284][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.009133
[2025-07-17 17:49:41,290][MEDS_extract.shard_events.shard_events][INFO] - Processing intermediate_dir/icu/chartevents.parquet to output_dir/shard_events/icu/chartevents.
[2025-07-17 17:49:41,291][MEDS_extract.shard_events.shard_events][INFO] - Performing preliminary read of /content/intermediate_dir/icu/chartevents.parquet to determine row count.
[2025-07-17 17:49:41,291][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:41,304][MEDS_extract.shard_events.shard_events][INFO] - Read 668862 rows from /content/intermediate_dir/icu/chartevents.parquet.
[2025-07-17 17:49:41,304][MEDS_extract.shard_events.shard_events][INFO] - Splitting intermediate_dir/icu/chartevents.parquet into 1 row-chunks of size 200000000.
[2025-07-17 17:49:41,305][MEDS_extract.shard_events.shard_events][INFO] - Writing file 1/1: intermediate_dir/icu/chartevents.parquet row-chunk [0-668862) to output_dir/shard_events/icu/chartevents/[0-668862).parquet.
[2025-07-17 17:49:41,305][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from intermediate_dir/icu/chartevents.parquet
[2025-07-17 17:49:41,306][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:41,306][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:41,307][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/shard_events/icu/chartevents/[0-668862).parquet
[2025-07-17 17:49:42,184][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.878552
[2025-07-17 17:49:42,188][MEDS_extract.shard_events.shard_events][INFO] - Processing intermediate_dir/icu/icustays.parquet to output_dir/shard_events/icu/icustays.
[2025-07-17 17:49:42,188][MEDS_extract.shard_events.shard_events][INFO] - Performing preliminary read of /content/intermediate_dir/icu/icustays.parquet to determine row count.
[2025-07-17 17:49:42,189][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:42,193][MEDS_extract.shard_events.shard_events][INFO] - Read 140 rows from /content/intermediate_dir/icu/icustays.parquet.
[2025-07-17 17:49:42,193][MEDS_extract.shard_events.shard_events][INFO] - Splitting intermediate_dir/icu/icustays.parquet into 1 row-chunks of size 200000000.
[2025-07-17 17:49:42,193][MEDS_extract.shard_events.shard_events][INFO] - Writing file 1/1: intermediate_dir/icu/icustays.parquet row-chunk [0-140) to output_dir/shard_events/icu/icustays/[0-140).parquet.
[2025-07-17 17:49:42,194][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from intermediate_dir/icu/icustays.parquet
[2025-07-17 17:49:42,194][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:42,195][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:42,195][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/shard_events/icu/icustays/[0-140).parquet
[2025-07-17 17:49:42,207][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.013370
[2025-07-17 17:49:42,209][MEDS_extract.shard_events.shard_events][INFO] - Processing intermediate_dir/hosp/patients.parquet to output_dir/shard_events/hosp/patients.
[2025-07-17 17:49:42,209][MEDS_extract.shard_events.shard_events][INFO] - Performing preliminary read of /content/intermediate_dir/hosp/patients.parquet to determine row count.
[2025-07-17 17:49:42,210][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:42,218][MEDS_extract.shard_events.shard_events][INFO] - Read 100 rows from /content/intermediate_dir/hosp/patients.parquet.
[2025-07-17 17:49:42,218][MEDS_extract.shard_events.shard_events][INFO] - Splitting intermediate_dir/hosp/patients.parquet into 1 row-chunks of size 200000000.
[2025-07-17 17:49:42,218][MEDS_extract.shard_events.shard_events][INFO] - Writing file 1/1: intermediate_dir/hosp/patients.parquet row-chunk [0-100) to output_dir/shard_events/hosp/patients/[0-100).parquet.
[2025-07-17 17:49:42,219][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from intermediate_dir/hosp/patients.parquet
[2025-07-17 17:49:42,220][MEDS_extract.shard_events.shard_events][INFO] - Ignoring infer_schema_length=10000 for Parquet files.
[2025-07-17 17:49:42,221][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:42,221][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/shard_events/hosp/patients/[0-100).parquet
[2025-07-17 17:49:42,230][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.011276
[2025-07-17 17:49:42,231][MEDS_extract.shard_events.shard_events][INFO] - Sub-sharding completed in 0:00:01.034039

INFO:MEDS_transforms.runner:Command error:

INFO:MEDS_transforms.runner:Running stage: split_and_shard_subjects
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml split_and_shard_subjects stage=split_and_shard_subjects input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:49:45,804][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Reading event conversion config from MESSY.yaml (needed for subject ID columns)
[2025-07-17 17:49:45,820][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Event conversion config:
subject_id_col: subject_id
hosp/patients:
  gender:
    code: col(gender)
    time: null
  death:
    code: MEDS_DEATH
    time: col(dod)
  birth:
    code: MEDS_BIRTH
    time: col(year_of_birth)
    time_format: &#x27;%Y&#x27;
hosp/admissions:
  ed_registration:
    code: ED_REGISTRATION
    time: col(edregtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  ed_out:
    code: ED_OUT
    time: col(edouttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  admission:
    code:
    - HOSPITAL_ADMISSION
    - col(admission_type)
    - col(admission_location)
    time: col(admittime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
  discharge:
    code:
    - HOSPITAL_DISCHARGE
    - col(discharge_location)
    time: col(dischtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
hosp/procedures_icd:
  procedure_icd:
    code:
    - PROCEDURE
    - ICD
    - coi(icd_version)
    - col(icd_code)
    time: col(chartdate)
    seq_num: seq_num
icu/icustays:
  admission:
    code:
    - ICU_ADMISSION
    - col(first_careunit)
    time: col(intime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  discharge:
    code:
    - ICU_DISCHARGE
    - col(last_careunit)
    time: col(outtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
icu/chartevents:
  chartevent:
    code:
    - CHARTEVENT
    - col(itemid)
    - col(valueuom)
    time: col(charttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    numeric_value: valuenum

[2025-07-17 17:49:45,821][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Reading subject IDs from hosp/patients files:
  - /content/output_dir/shard_events/hosp/patients/[0-100).parquet
[2025-07-17 17:49:45,823][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Reading subject IDs from hosp/admissions files:
  - /content/output_dir/shard_events/hosp/admissions/[0-275).parquet
[2025-07-17 17:49:45,823][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Reading subject IDs from hosp/procedures_icd files:
  - /content/output_dir/shard_events/hosp/procedures_icd/[0-722).parquet
[2025-07-17 17:49:45,824][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Reading subject IDs from icu/icustays files:
  - /content/output_dir/shard_events/icu/icustays/[0-140).parquet
[2025-07-17 17:49:45,824][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Reading subject IDs from icu/chartevents files:
  - /content/output_dir/shard_events/icu/chartevents/[0-668862).parquet
[2025-07-17 17:49:45,824][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Joining all subject IDs from 5 dataframes
[2025-07-17 17:49:45,925][numexpr.utils][INFO] - NumExpr defaulting to 2 threads.
[2025-07-17 17:49:46,127][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Found 100 unique subject IDs of type int64
[2025-07-17 17:49:46,128][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Sharding and splitting subjects
[2025-07-17 17:49:46,129][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Split train/0 has 80 subjects.
[2025-07-17 17:49:46,129][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Split tuning/0 has 10 subjects.
[2025-07-17 17:49:46,129][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Split held_out/0 has 10 subjects.
[2025-07-17 17:49:46,130][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Writing sharded subjects to /content/output_dir/metadata/.shards.json
[2025-07-17 17:49:46,131][MEDS_extract.split_and_shard_subjects.split_and_shard_subjects][INFO] - Done writing sharded subjects

INFO:MEDS_transforms.runner:Command error:

INFO:MEDS_transforms.runner:Running stage: convert_to_subject_sharded
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml convert_to_subject_sharded stage=convert_to_subject_sharded input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:49:48,010][MEDS_extract.convert_to_subject_sharded.convert_to_subject_sharded][INFO] - Starting subject sharding.
[2025-07-17 17:49:48,010][MEDS_extract.convert_to_subject_sharded.convert_to_subject_sharded][INFO] - Reading event conversion config from MESSY.yaml
[2025-07-17 17:49:48,026][MEDS_extract.convert_to_subject_sharded.convert_to_subject_sharded][INFO] - Event conversion config:
subject_id_col: subject_id
hosp/patients:
  gender:
    code: col(gender)
    time: null
  death:
    code: MEDS_DEATH
    time: col(dod)
  birth:
    code: MEDS_BIRTH
    time: col(year_of_birth)
    time_format: &#x27;%Y&#x27;
hosp/admissions:
  ed_registration:
    code: ED_REGISTRATION
    time: col(edregtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  ed_out:
    code: ED_OUT
    time: col(edouttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  admission:
    code:
    - HOSPITAL_ADMISSION
    - col(admission_type)
    - col(admission_location)
    time: col(admittime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
  discharge:
    code:
    - HOSPITAL_DISCHARGE
    - col(discharge_location)
    time: col(dischtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
hosp/procedures_icd:
  procedure_icd:
    code:
    - PROCEDURE
    - ICD
    - coi(icd_version)
    - col(icd_code)
    time: col(chartdate)
    seq_num: seq_num
icu/icustays:
  admission:
    code:
    - ICU_ADMISSION
    - col(first_careunit)
    time: col(intime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  discharge:
    code:
    - ICU_DISCHARGE
    - col(last_careunit)
    time: col(outtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
icu/chartevents:
  chartevent:
    code:
    - CHARTEVENT
    - col(itemid)
    - col(valueuom)
    time: col(charttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    numeric_value: valuenum

[2025-07-17 17:49:48,028][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/patients/[0-100).parquet&#x27;)]
[2025-07-17 17:49:48,030][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,030][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/tuning/0/hosp/patients.parquet
[2025-07-17 17:49:48,036][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.008897
[2025-07-17 17:49:48,038][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/procedures_icd/[0-722).parquet&#x27;)]
[2025-07-17 17:49:48,039][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,039][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/tuning/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:48,042][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003652
[2025-07-17 17:49:48,044][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/admissions/[0-275).parquet&#x27;)]
[2025-07-17 17:49:48,044][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,044][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/tuning/0/hosp/admissions.parquet
[2025-07-17 17:49:48,047][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003944
[2025-07-17 17:49:48,049][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/icu/chartevents/[0-668862).parquet&#x27;)]
[2025-07-17 17:49:48,050][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,050][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/tuning/0/icu/chartevents.parquet
[2025-07-17 17:49:48,105][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.056211
[2025-07-17 17:49:48,107][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/icu/icustays/[0-140).parquet&#x27;)]
[2025-07-17 17:49:48,107][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,107][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/tuning/0/icu/icustays.parquet
[2025-07-17 17:49:48,110][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003717
[2025-07-17 17:49:48,112][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/patients/[0-100).parquet&#x27;)]
[2025-07-17 17:49:48,112][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,112][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/held_out/0/hosp/patients.parquet
[2025-07-17 17:49:48,115][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003670
[2025-07-17 17:49:48,117][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/procedures_icd/[0-722).parquet&#x27;)]
[2025-07-17 17:49:48,117][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,117][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/held_out/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:48,120][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003151
[2025-07-17 17:49:48,122][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/admissions/[0-275).parquet&#x27;)]
[2025-07-17 17:49:48,122][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,122][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/held_out/0/hosp/admissions.parquet
[2025-07-17 17:49:48,126][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003903
[2025-07-17 17:49:48,127][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/icu/chartevents/[0-668862).parquet&#x27;)]
[2025-07-17 17:49:48,127][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,128][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/held_out/0/icu/chartevents.parquet
[2025-07-17 17:49:48,161][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.034368
[2025-07-17 17:49:48,163][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/icu/icustays/[0-140).parquet&#x27;)]
[2025-07-17 17:49:48,163][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,164][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/held_out/0/icu/icustays.parquet
[2025-07-17 17:49:48,166][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003498
[2025-07-17 17:49:48,168][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/patients/[0-100).parquet&#x27;)]
[2025-07-17 17:49:48,169][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,169][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/train/0/hosp/patients.parquet
[2025-07-17 17:49:48,171][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003106
[2025-07-17 17:49:48,172][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/procedures_icd/[0-722).parquet&#x27;)]
[2025-07-17 17:49:48,173][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,173][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/train/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:48,176][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003341
[2025-07-17 17:49:48,178][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/hosp/admissions/[0-275).parquet&#x27;)]
[2025-07-17 17:49:48,178][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,178][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/train/0/hosp/admissions.parquet
[2025-07-17 17:49:48,182][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.004345
[2025-07-17 17:49:48,183][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/icu/chartevents/[0-668862).parquet&#x27;)]
[2025-07-17 17:49:48,184][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,184][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/train/0/icu/chartevents.parquet
[2025-07-17 17:49:48,379][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.195991
[2025-07-17 17:49:48,381][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from [PosixPath(&#x27;output_dir/shard_events/icu/icustays/[0-140).parquet&#x27;)]
[2025-07-17 17:49:48,381][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:48,381][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_subject_sharded/train/0/icu/icustays.parquet
[2025-07-17 17:49:48,384][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.003644
[2025-07-17 17:49:48,385][MEDS_extract.convert_to_subject_sharded.convert_to_subject_sharded][INFO] - Created a subject-sharded view.

INFO:MEDS_transforms.runner:Command error:
/usr/local/lib/python3.11/dist-packages/MEDS_extract/convert_to_subject_sharded/convert_to_subject_sharded.py:75: PerformanceWarning: Resolving the schema of a LazyFrame is a potentially expensive operation. Use `LazyFrame.collect_schema()` to get the schema without this warning.
  typed_subjects = pl.Series(subjects, dtype=dfs[0].schema[input_subject_id_column])

INFO:MEDS_transforms.runner:Running stage: convert_to_MEDS_events
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml convert_to_MEDS_events stage=convert_to_MEDS_events input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:49:50,205][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Starting event conversion.
[2025-07-17 17:49:50,205][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Reading event conversion config from MESSY.yaml
[2025-07-17 17:49:50,221][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Event conversion config:
subject_id_col: subject_id
hosp/patients:
  gender:
    code: col(gender)
    time: null
  death:
    code: MEDS_DEATH
    time: col(dod)
  birth:
    code: MEDS_BIRTH
    time: col(year_of_birth)
    time_format: &#x27;%Y&#x27;
hosp/admissions:
  ed_registration:
    code: ED_REGISTRATION
    time: col(edregtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  ed_out:
    code: ED_OUT
    time: col(edouttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  admission:
    code:
    - HOSPITAL_ADMISSION
    - col(admission_type)
    - col(admission_location)
    time: col(admittime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
  discharge:
    code:
    - HOSPITAL_DISCHARGE
    - col(discharge_location)
    time: col(dischtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
hosp/procedures_icd:
  procedure_icd:
    code:
    - PROCEDURE
    - ICD
    - coi(icd_version)
    - col(icd_code)
    time: col(chartdate)
    seq_num: seq_num
icu/icustays:
  admission:
    code:
    - ICU_ADMISSION
    - col(first_careunit)
    time: col(intime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  discharge:
    code:
    - ICU_DISCHARGE
    - col(last_careunit)
    time: col(outtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
icu/chartevents:
  chartevent:
    code:
    - CHARTEVENT
    - col(itemid)
    - col(valueuom)
    time: col(charttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    numeric_value: valuenum

[2025-07-17 17:49:50,227][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/train/0/hosp/patients.parquet
[2025-07-17 17:49:50,228][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,228][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/patients
[2025-07-17 17:49:50,229][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting gender
[2025-07-17 17:49:50,230][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column gender
[2025-07-17 17:49:50,231][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding null literate for time
[2025-07-17 17:49:50,231][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null codes via col(&quot;gender&quot;).is_not_null()
[2025-07-17 17:49:50,231][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting death
[2025-07-17 17:49:50,231][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - dod should already be of Datetime type
[2025-07-17 17:49:50,232][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;dod&quot;).is_not_null()
[2025-07-17 17:49:50,232][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting birth
[2025-07-17 17:49:50,232][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column year_of_birth in possible formats %Y
[2025-07-17 17:49:50,232][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;year_of_birth&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,233][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/train/0/hosp/patients.parquet
[2025-07-17 17:49:50,241][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.013788
[2025-07-17 17:49:50,242][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/train/0/icu/chartevents.parquet
[2025-07-17 17:49:50,243][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,243][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for icu/chartevents
[2025-07-17 17:49:50,244][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting chartevent
[2025-07-17 17:49:50,245][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column valueuom
[2025-07-17 17:49:50,245][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column itemid
[2025-07-17 17:49:50,245][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column charttime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,245][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;charttime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,245][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/train/0/icu/chartevents.parquet
[2025-07-17 17:49:50,695][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.452166
[2025-07-17 17:49:50,696][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/train/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:50,696][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,697][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/procedures_icd
[2025-07-17 17:49:50,697][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting procedure_icd
[2025-07-17 17:49:50,698][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column icd_code
[2025-07-17 17:49:50,698][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - chartdate should already be of Datetime type
[2025-07-17 17:49:50,698][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;chartdate&quot;).is_not_null()
[2025-07-17 17:49:50,699][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/train/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:50,702][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.006156
[2025-07-17 17:49:50,704][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/train/0/hosp/admissions.parquet
[2025-07-17 17:49:50,704][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,705][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/admissions
[2025-07-17 17:49:50,706][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting ed_registration
[2025-07-17 17:49:50,706][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column edregtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,707][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;edregtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,707][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting ed_out
[2025-07-17 17:49:50,707][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column edouttime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,707][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;edouttime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,708][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting admission
[2025-07-17 17:49:50,708][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column admission_type
[2025-07-17 17:49:50,708][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column admission_location
[2025-07-17 17:49:50,708][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column admittime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,709][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;admittime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,709][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting discharge
[2025-07-17 17:49:50,709][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column discharge_location
[2025-07-17 17:49:50,710][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column dischtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,710][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;dischtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,710][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/train/0/hosp/admissions.parquet
[2025-07-17 17:49:50,716][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.011979
[2025-07-17 17:49:50,718][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/train/0/icu/icustays.parquet
[2025-07-17 17:49:50,718][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,718][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for icu/icustays
[2025-07-17 17:49:50,719][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting admission
[2025-07-17 17:49:50,720][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column first_careunit
[2025-07-17 17:49:50,720][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column intime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,720][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;intime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,720][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting discharge
[2025-07-17 17:49:50,721][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column last_careunit
[2025-07-17 17:49:50,721][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column outtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,721][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;outtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,721][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/train/0/icu/icustays.parquet
[2025-07-17 17:49:50,725][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.007194
[2025-07-17 17:49:50,726][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/held_out/0/hosp/patients.parquet
[2025-07-17 17:49:50,727][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,727][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/patients
[2025-07-17 17:49:50,727][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting gender
[2025-07-17 17:49:50,728][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column gender
[2025-07-17 17:49:50,728][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding null literate for time
[2025-07-17 17:49:50,728][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null codes via col(&quot;gender&quot;).is_not_null()
[2025-07-17 17:49:50,728][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting death
[2025-07-17 17:49:50,729][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - dod should already be of Datetime type
[2025-07-17 17:49:50,729][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;dod&quot;).is_not_null()
[2025-07-17 17:49:50,729][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting birth
[2025-07-17 17:49:50,729][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column year_of_birth in possible formats %Y
[2025-07-17 17:49:50,730][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;year_of_birth&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,730][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/held_out/0/hosp/patients.parquet
[2025-07-17 17:49:50,734][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.007166
[2025-07-17 17:49:50,735][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/held_out/0/icu/chartevents.parquet
[2025-07-17 17:49:50,735][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,735][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for icu/chartevents
[2025-07-17 17:49:50,736][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting chartevent
[2025-07-17 17:49:50,736][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column valueuom
[2025-07-17 17:49:50,737][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column itemid
[2025-07-17 17:49:50,737][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column charttime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,737][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;charttime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,737][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/held_out/0/icu/chartevents.parquet
[2025-07-17 17:49:50,763][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.028126
[2025-07-17 17:49:50,764][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/held_out/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:50,765][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,765][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/procedures_icd
[2025-07-17 17:49:50,765][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting procedure_icd
[2025-07-17 17:49:50,766][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column icd_code
[2025-07-17 17:49:50,766][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - chartdate should already be of Datetime type
[2025-07-17 17:49:50,767][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;chartdate&quot;).is_not_null()
[2025-07-17 17:49:50,767][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/held_out/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:50,770][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.005439
[2025-07-17 17:49:50,772][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/held_out/0/hosp/admissions.parquet
[2025-07-17 17:49:50,772][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,772][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/admissions
[2025-07-17 17:49:50,773][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting ed_registration
[2025-07-17 17:49:50,774][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column edregtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,774][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;edregtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,774][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting ed_out
[2025-07-17 17:49:50,775][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column edouttime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,775][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;edouttime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,775][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting admission
[2025-07-17 17:49:50,776][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column admission_type
[2025-07-17 17:49:50,776][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column admission_location
[2025-07-17 17:49:50,776][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column admittime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,776][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;admittime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,776][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting discharge
[2025-07-17 17:49:50,777][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column discharge_location
[2025-07-17 17:49:50,777][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column dischtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,777][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;dischtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,778][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/held_out/0/hosp/admissions.parquet
[2025-07-17 17:49:50,783][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.011343
[2025-07-17 17:49:50,785][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/held_out/0/icu/icustays.parquet
[2025-07-17 17:49:50,785][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,785][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for icu/icustays
[2025-07-17 17:49:50,786][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting admission
[2025-07-17 17:49:50,787][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column first_careunit
[2025-07-17 17:49:50,787][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column intime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,787][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;intime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,787][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting discharge
[2025-07-17 17:49:50,788][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column last_careunit
[2025-07-17 17:49:50,788][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column outtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,788][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;outtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,788][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/held_out/0/icu/icustays.parquet
[2025-07-17 17:49:50,791][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.006842
[2025-07-17 17:49:50,793][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/tuning/0/hosp/patients.parquet
[2025-07-17 17:49:50,793][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,793][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/patients
[2025-07-17 17:49:50,794][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting gender
[2025-07-17 17:49:50,795][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column gender
[2025-07-17 17:49:50,795][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding null literate for time
[2025-07-17 17:49:50,795][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null codes via col(&quot;gender&quot;).is_not_null()
[2025-07-17 17:49:50,795][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting death
[2025-07-17 17:49:50,796][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - dod should already be of Datetime type
[2025-07-17 17:49:50,796][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;dod&quot;).is_not_null()
[2025-07-17 17:49:50,796][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting birth
[2025-07-17 17:49:50,796][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column year_of_birth in possible formats %Y
[2025-07-17 17:49:50,796][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;year_of_birth&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,797][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/tuning/0/hosp/patients.parquet
[2025-07-17 17:49:50,800][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.007281
[2025-07-17 17:49:50,802][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/tuning/0/icu/chartevents.parquet
[2025-07-17 17:49:50,802][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,802][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for icu/chartevents
[2025-07-17 17:49:50,803][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting chartevent
[2025-07-17 17:49:50,803][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column valueuom
[2025-07-17 17:49:50,803][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column itemid
[2025-07-17 17:49:50,804][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column charttime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,804][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;charttime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,804][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/tuning/0/icu/chartevents.parquet
[2025-07-17 17:49:50,843][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.040857
[2025-07-17 17:49:50,844][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/tuning/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:50,845][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,845][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/procedures_icd
[2025-07-17 17:49:50,845][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting procedure_icd
[2025-07-17 17:49:50,846][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column icd_code
[2025-07-17 17:49:50,846][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - chartdate should already be of Datetime type
[2025-07-17 17:49:50,847][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;chartdate&quot;).is_not_null()
[2025-07-17 17:49:50,847][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/tuning/0/hosp/procedures_icd.parquet
[2025-07-17 17:49:50,851][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.007183
[2025-07-17 17:49:50,853][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/tuning/0/hosp/admissions.parquet
[2025-07-17 17:49:50,853][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,853][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for hosp/admissions
[2025-07-17 17:49:50,855][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting ed_registration
[2025-07-17 17:49:50,855][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column edregtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,855][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;edregtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,856][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting ed_out
[2025-07-17 17:49:50,856][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column edouttime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,856][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;edouttime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,856][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting admission
[2025-07-17 17:49:50,857][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column admission_type
[2025-07-17 17:49:50,857][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column admission_location
[2025-07-17 17:49:50,857][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column admittime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,857][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;admittime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,858][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting discharge
[2025-07-17 17:49:50,858][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column discharge_location
[2025-07-17 17:49:50,858][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column dischtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,858][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;dischtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,859][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/tuning/0/hosp/admissions.parquet
[2025-07-17 17:49:50,864][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.010504
[2025-07-17 17:49:50,865][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_subject_sharded/tuning/0/icu/icustays.parquet
[2025-07-17 17:49:50,865][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:50,866][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting events for icu/icustays
[2025-07-17 17:49:50,866][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting admission
[2025-07-17 17:49:50,867][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column first_careunit
[2025-07-17 17:49:50,867][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column intime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,867][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;intime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,868][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Building computational graph for extracting discharge
[2025-07-17 17:49:50,868][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Extracting column last_careunit
[2025-07-17 17:49:50,868][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Adding time column outtime in possible formats %Y-%m-%d %H:%M:%S
[2025-07-17 17:49:50,868][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Filtering out rows with null times via col(&quot;outtime&quot;).str.strptime([&quot;raise&quot;]).coalesce().is_not_null()
[2025-07-17 17:49:50,869][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/convert_to_MEDS_events/tuning/0/icu/icustays.parquet
[2025-07-17 17:49:50,872][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.006402
[2025-07-17 17:49:50,872][MEDS_extract.convert_to_MEDS_events.convert_to_MEDS_events][INFO] - Subsharded into converted events.

INFO:MEDS_transforms.runner:Command error:

INFO:MEDS_transforms.runner:Running stage: merge_to_MEDS_cohort
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml merge_to_MEDS_cohort stage=merge_to_MEDS_cohort input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:49:52,716][MEDS_extract.merge_to_MEDS_cohort.merge_to_MEDS_cohort][INFO] - Mapping computation over a maximum of 3 shards
[2025-07-17 17:49:52,717][MEDS_transforms.mapreduce.mapper][INFO] - Processing /content/output_dir/convert_to_MEDS_events/held_out/0 into /content/output_dir/merge_to_MEDS_cohort/held_out/0.parquet
[2025-07-17 17:49:52,717][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_MEDS_events/held_out/0
[2025-07-17 17:49:52,718][MEDS_extract.merge_to_MEDS_cohort.merge_to_MEDS_cohort][INFO] - Reading 5 files:
  - /content/output_dir/convert_to_MEDS_events/held_out/0/hosp/patients.parquet
  - /content/output_dir/convert_to_MEDS_events/held_out/0/hosp/admissions.parquet
  - /content/output_dir/convert_to_MEDS_events/held_out/0/hosp/procedures_icd.parquet
  - /content/output_dir/convert_to_MEDS_events/held_out/0/icu/icustays.parquet
  - /content/output_dir/convert_to_MEDS_events/held_out/0/icu/chartevents.parquet
[2025-07-17 17:49:52,720][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:52,720][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/merge_to_MEDS_cohort/held_out/0.parquet
[2025-07-17 17:49:52,752][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.034519
[2025-07-17 17:49:52,752][MEDS_transforms.mapreduce.mapper][INFO] - Processing /content/output_dir/convert_to_MEDS_events/tuning/0 into /content/output_dir/merge_to_MEDS_cohort/tuning/0.parquet
[2025-07-17 17:49:52,753][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_MEDS_events/tuning/0
[2025-07-17 17:49:52,753][MEDS_extract.merge_to_MEDS_cohort.merge_to_MEDS_cohort][INFO] - Reading 5 files:
  - /content/output_dir/convert_to_MEDS_events/tuning/0/hosp/patients.parquet
  - /content/output_dir/convert_to_MEDS_events/tuning/0/hosp/admissions.parquet
  - /content/output_dir/convert_to_MEDS_events/tuning/0/hosp/procedures_icd.parquet
  - /content/output_dir/convert_to_MEDS_events/tuning/0/icu/icustays.parquet
  - /content/output_dir/convert_to_MEDS_events/tuning/0/icu/chartevents.parquet
[2025-07-17 17:49:52,754][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:52,754][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/merge_to_MEDS_cohort/tuning/0.parquet
[2025-07-17 17:49:52,799][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.046454
[2025-07-17 17:49:52,800][MEDS_transforms.mapreduce.mapper][INFO] - Processing /content/output_dir/convert_to_MEDS_events/train/0 into /content/output_dir/merge_to_MEDS_cohort/train/0.parquet
[2025-07-17 17:49:52,801][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/convert_to_MEDS_events/train/0
[2025-07-17 17:49:52,801][MEDS_extract.merge_to_MEDS_cohort.merge_to_MEDS_cohort][INFO] - Reading 5 files:
  - /content/output_dir/convert_to_MEDS_events/train/0/hosp/patients.parquet
  - /content/output_dir/convert_to_MEDS_events/train/0/hosp/admissions.parquet
  - /content/output_dir/convert_to_MEDS_events/train/0/hosp/procedures_icd.parquet
  - /content/output_dir/convert_to_MEDS_events/train/0/icu/icustays.parquet
  - /content/output_dir/convert_to_MEDS_events/train/0/icu/chartevents.parquet
[2025-07-17 17:49:52,802][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:49:52,802][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/merge_to_MEDS_cohort/train/0.parquet
[2025-07-17 17:49:53,295][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.494605
[2025-07-17 17:49:53,295][MEDS_transforms.mapreduce.stage][INFO] - Finished mapping in 0:00:00.581387

INFO:MEDS_transforms.runner:Command error:

INFO:MEDS_transforms.runner:Running stage: extract_code_metadata
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml extract_code_metadata stage=extract_code_metadata input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:49:55,490][MEDS_extract.extract_code_metadata.extract_code_metadata][INFO] - Reading event conversion config from MESSY.yaml
[2025-07-17 17:49:55,515][MEDS_extract.extract_code_metadata.extract_code_metadata][INFO] - Event conversion config:
subject_id_col: subject_id
hosp/patients:
  gender:
    code: col(gender)
    time: null
  death:
    code: MEDS_DEATH
    time: col(dod)
  birth:
    code: MEDS_BIRTH
    time: col(year_of_birth)
    time_format: &#x27;%Y&#x27;
hosp/admissions:
  ed_registration:
    code: ED_REGISTRATION
    time: col(edregtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  ed_out:
    code: ED_OUT
    time: col(edouttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  admission:
    code:
    - HOSPITAL_ADMISSION
    - col(admission_type)
    - col(admission_location)
    time: col(admittime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
  discharge:
    code:
    - HOSPITAL_DISCHARGE
    - col(discharge_location)
    time: col(dischtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    hadm_id: hadm_id
hosp/procedures_icd:
  procedure_icd:
    code:
    - PROCEDURE
    - ICD
    - coi(icd_version)
    - col(icd_code)
    time: col(chartdate)
    seq_num: seq_num
icu/icustays:
  admission:
    code:
    - ICU_ADMISSION
    - col(first_careunit)
    time: col(intime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
  discharge:
    code:
    - ICU_DISCHARGE
    - col(last_careunit)
    time: col(outtime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
icu/chartevents:
  chartevent:
    code:
    - CHARTEVENT
    - col(itemid)
    - col(valueuom)
    time: col(charttime)
    time_format: &#x27;%Y-%m-%d %H:%M:%S&#x27;
    numeric_value: valuenum

[2025-07-17 17:49:55,523][MEDS_extract.extract_code_metadata.extract_code_metadata][INFO] - No _metadata blocks in the event_conversion_config.yaml found. Exiting...

INFO:MEDS_transforms.runner:Command error:

INFO:MEDS_transforms.runner:Running stage: finalize_MEDS_metadata
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml finalize_MEDS_metadata stage=finalize_MEDS_metadata input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:49:58,056][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Validating code metadata
[2025-07-17 17:49:58,056][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - No code metadata found at output_dir/extract_code_metadata/codes.parquet. Making empty metadata file.
[2025-07-17 17:49:58,133][numexpr.utils][INFO] - NumExpr defaulting to 2 threads.
[2025-07-17 17:49:58,336][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Writing finalized metadata df to /content/output_dir/metadata/codes.parquet
[2025-07-17 17:49:58,337][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Creating dataset metadata
[2025-07-17 17:49:58,340][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Writing finalized dataset metadata to /content/output_dir/metadata/dataset.json
[2025-07-17 17:49:58,340][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Creating subject splits from {str(shards_map_fp.resolve())}
[2025-07-17 17:49:58,341][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Split train has 80 subjects
[2025-07-17 17:49:58,341][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Split tuning has 10 subjects
[2025-07-17 17:49:58,341][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Split held_out has 10 subjects
[2025-07-17 17:49:58,341][MEDS_extract.finalize_MEDS_metadata.finalize_MEDS_metadata][INFO] - Writing finalized subject splits to /content/output_dir/metadata/subject_splits.parquet

INFO:MEDS_transforms.runner:Command error:

INFO:MEDS_transforms.runner:Running stage: finalize_MEDS_data
INFO:MEDS_transforms.runner:Running command: MEDS_transform-stage pkg://MEDS_extract.configs._extract.yaml finalize_MEDS_data stage=finalize_MEDS_data input_dir=intermediate_dir output_dir=output_dir event_conversion_config_fp=MESSY.yaml dataset.name=KDD_Tutorial dataset.version=1.0
INFO:MEDS_transforms.runner:Command output:
[2025-07-17 17:50:00,222][MEDS_transforms.mapreduce.shard_iteration][INFO] - Mapping computation over a maximum of 3 shards
[2025-07-17 17:50:00,223][MEDS_transforms.mapreduce.mapper][INFO] - Processing /content/output_dir/merge_to_MEDS_cohort/held_out/0.parquet into /content/output_dir/data/held_out/0.parquet
[2025-07-17 17:50:00,224][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/merge_to_MEDS_cohort/held_out/0.parquet
[2025-07-17 17:50:00,224][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:50:00,235][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/data/held_out/0.parquet
[2025-07-17 17:50:00,242][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.018772
[2025-07-17 17:50:00,243][MEDS_transforms.mapreduce.mapper][INFO] - Processing /content/output_dir/merge_to_MEDS_cohort/tuning/0.parquet into /content/output_dir/data/tuning/0.parquet
[2025-07-17 17:50:00,243][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/merge_to_MEDS_cohort/tuning/0.parquet
[2025-07-17 17:50:00,244][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:50:00,249][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/data/tuning/0.parquet
[2025-07-17 17:50:00,260][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.016874
[2025-07-17 17:50:00,261][MEDS_transforms.mapreduce.mapper][INFO] - Processing /content/output_dir/merge_to_MEDS_cohort/train/0.parquet into /content/output_dir/data/train/0.parquet
[2025-07-17 17:50:00,261][MEDS_transforms.mapreduce.rwlock][INFO] - Reading input dataframe from output_dir/merge_to_MEDS_cohort/train/0.parquet
[2025-07-17 17:50:00,262][MEDS_transforms.mapreduce.rwlock][INFO] - Read dataset
[2025-07-17 17:50:00,302][MEDS_transforms.mapreduce.rwlock][INFO] - Writing final output to output_dir/data/train/0.parquet
[2025-07-17 17:50:00,404][MEDS_transforms.mapreduce.rwlock][INFO] - Succeeded in 0:00:00.143007
[2025-07-17 17:50:00,405][MEDS_transforms.mapreduce.stage][INFO] - Finished mapping in 0:00:00.184304

INFO:MEDS_transforms.runner:Command error:

</pre></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>Note that if you did everything right, the log will still say <code>&quot;Command error:&quot;</code> at the end, with nothing following, which is reporting that there was <em>no</em> error output written for the internal stages of the process.</p>
<p>What do the output files themselves actually look like? Let&#x27;s see:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[19]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>%%bash
</span>tree output_dir</code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">output_dir
├── convert_to_MEDS_events
│   ├── event_conversion_config.yaml
│   ├── held_out
│   │   └── 0
│   │       ├── hosp
│   │       │   ├── admissions.parquet
│   │       │   ├── patients.parquet
│   │       │   └── procedures_icd.parquet
│   │       └── icu
│   │           ├── chartevents.parquet
│   │           └── icustays.parquet
│   ├── train
│   │   └── 0
│   │       ├── hosp
│   │       │   ├── admissions.parquet
│   │       │   ├── patients.parquet
│   │       │   └── procedures_icd.parquet
│   │       └── icu
│   │           ├── chartevents.parquet
│   │           └── icustays.parquet
│   └── tuning
│       └── 0
│           ├── hosp
│           │   ├── admissions.parquet
│           │   ├── patients.parquet
│           │   └── procedures_icd.parquet
│           └── icu
│               ├── chartevents.parquet
│               └── icustays.parquet
├── convert_to_subject_sharded
│   ├── held_out
│   │   └── 0
│   │       ├── hosp
│   │       │   ├── admissions.parquet
│   │       │   ├── patients.parquet
│   │       │   └── procedures_icd.parquet
│   │       └── icu
│   │           ├── chartevents.parquet
│   │           └── icustays.parquet
│   ├── train
│   │   └── 0
│   │       ├── hosp
│   │       │   ├── admissions.parquet
│   │       │   ├── patients.parquet
│   │       │   └── procedures_icd.parquet
│   │       └── icu
│   │           ├── chartevents.parquet
│   │           └── icustays.parquet
│   └── tuning
│       └── 0
│           ├── hosp
│           │   ├── admissions.parquet
│           │   ├── patients.parquet
│           │   └── procedures_icd.parquet
│           └── icu
│               ├── chartevents.parquet
│               └── icustays.parquet
├── data
│   ├── held_out
│   │   └── 0.parquet
│   ├── train
│   │   └── 0.parquet
│   └── tuning
│       └── 0.parquet
├── extract_code_metadata
│   └── event_conversion_config.yaml
├── finalize_MEDS_metadata
├── merge_to_MEDS_cohort
│   ├── held_out
│   │   └── 0.parquet
│   ├── train
│   │   └── 0.parquet
│   └── tuning
│       └── 0.parquet
├── metadata
│   ├── codes.parquet
│   ├── dataset.json
│   └── subject_splits.parquet
├── shard_events
│   ├── hosp
│   │   ├── admissions
│   │   │   └── [0-275).parquet
│   │   ├── patients
│   │   │   └── [0-100).parquet
│   │   └── procedures_icd
│   │       └── [0-722).parquet
│   └── icu
│       ├── chartevents
│       │   └── [0-668862).parquet
│       └── icustays
│           └── [0-140).parquet
└── split_and_shard_subjects

46 directories, 46 files
</pre></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><p>There&#x27;s a lot here -- thankfully, most of them are internal, partial outputs that MEDS-Extract writes so it can resume after failures on larger datasets. These aren&#x27;t helpful for us, but are helpful when you&#x27;re working with hundreds of thousands to billions of measurements!</p>
<p>To see just the final files, we can look in the <code>data</code> and <code>metadata</code> sub-folders:</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[20]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>%%bash
</span>tree output_dir/data</code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">output_dir/data
├── held_out
│   └── 0.parquet
├── train
│   └── 0.parquet
└── tuning
    └── 0.parquet

3 directories, 3 files
</pre></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source">[21]: </pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">1</span><span> 
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;width:37px;padding:0 8px 0 8px;box-sizing:border-box;color:#999999">2</span></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"><span>%%bash
</span>tree output_dir/metadata</code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div><div class="cell-row"><pre class="cell-header output"></pre><pre class="cell-content output-std">output_dir/metadata
├── codes.parquet
├── dataset.json
└── subject_splits.parquet

0 directories, 3 files
</pre></div></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Going Forward</h3>
<p>While you&#x27;ve just built a great MEDS dataset over the MIMIC demo dataset in this tutorial, you&#x27;ve only looked at a small set of the included files we showed above. In the rest of the tutorial, we&#x27;ll use the full MIMIC demo dataset, which we&#x27;ll download as needed in the other notebooks, rather than the output of this notebook. But rest assured -- it is very similar to what you put together here. You can see how it is processed by looking at the dedicated <a href="https://github.com/Medical-Event-Data-Standard/MIMIC_IV_MEDS/tree/main">MIMIC-IV ETL Package</a>, or specifically the analogus <a href="https://github.com/Medical-Event-Data-Standard/MIMIC_IV_MEDS/blob/main/src/MIMIC_IV_MEDS/configs/event_configs.yaml">MESSY file used for all the sources</a> in that repository!</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-markdown"><h3>Additional Details and Resources</h3>
<p>You can also check out <a href="https://meds-extract.readthedocs.io/en/latest/">MEDS-Extract&#x27;s documentation</a> and <a href="https://github.com/mmcdermott/MEDS_extract/tree/main/example">another example on synthetic data</a> via the included links as well!</p>
<p>Even more importantly, what if you don&#x27;t like MEDS-Extract and don&#x27;t want to use it? Then don&#x27;t! The three guiding questions of the extraction process (<em>What is happening?</em>, <em>To whom is it happening?</em>, and <em>When is it happening?</em>) can be turned into an extraction pipeline in whatever way you like -- the MEDS ecosystem is designed to be data-centric, so it doesn&#x27;t matter how you got to a MEDS dataset, just that you did, and then tools can run from there!</p></div></div></div></div><div class="block"><div class="block-source"><div class="block-light"></div><div class="cell-row"><pre class="cell-header source"></pre><div class="cell-content source-code"><pre style="display:block;overflow-x:auto;padding:5px 0 5px 0;background:#EEEEEE;color:black;width:37px;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;overflow:hidden"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"></code></pre><div class="source-code-main"><pre style="display:block;overflow-x:auto;padding:5px 4px 5px 4px;background:#F5F5F5;color:black;margin:0 0 0 0;box-sizing:border-box;border:solid 1px #E0E0E0;flex:1"><code style="white-space:pre;font-family:Menlo, Consolas, &#x27;DejaVu Sans Mono&#x27;, monospace;font-size:13px"></code></pre></div></div></div></div><div class="block-output"><div class="block-light"></div><div class="block-output-content"><div></div></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Medical-Event-Data-Standard/medical-event-data-standard.github.io/tree/main/docs/docs/tutorials/basic/converting_to_MEDS.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/tutorial---build-a-model-with-meds"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tutorial - Build a Model with MEDS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/basic/preprocessing_MEDS_data"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pre-processing MEDS Data</div></a></nav></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro_pages/intro">Tutorials</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/meds" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/Medical-Event-Data-Standard" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Medical-Event-Data-Standard" target="_blank" rel="noopener noreferrer" class="footer__link-item">Schema</a></li><li class="footer__item"><a href="https://github.com/mmcdermott/MEDS-DEV" target="_blank" rel="noopener noreferrer" class="footer__link-item">MEDS-DEV<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Medical Event Data Standard.</div></div></div></footer></div>
</body>
</html>